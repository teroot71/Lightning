/*
 * This code is for Internal Salesforce use only, and subject to change without notice.
 * Customers shouldn't reference this file in any web pages.
 */
Sfdc.ns("Sfdc.ChatterNotes");
Sfdc.ChatterNotes=function(){var l,m,n,h,k,g;this.getTitleFieldValue=function(){return Sfdc.get("noteTitle").value};this.init=function(b,a,c,d){var f=this;n=b;m=c;l=this.getTitleFieldValue();h=this.initEditor(m,d);setInterval(function(){f.updateLastSaved()},6E4);var e=window.onbeforeunload;window.onbeforeunload=function(){if(f.checkDirty())return LC.getLabel("ChatterNotesDetailPage","UnsavedEditsWarning");if(e)return e()}};this.initEditor=function(b,a,c){var d=this;a={readOnly:a,resize_enabled:!1,
height:"560px",extraAllowedContent:"p[onclick];li[onclick];img[!src,alt,width,height,border]{*}(*);strike;s;",removePlugins:"elementspath, magicline",extraPlugins:"pastetext",toolbar:[{name:"basicstyles",groups:["basicstyles","cleanup"],items:"Bold Italic Underline BulletedList NumberedList Outdent Indent".split(" ")}],forcePasteAsPlainText:!0,on:{change:function(b){d.checkDirty()},instanceReady:function(a){this.setData(b,{callback:function(){this.resetDirty();d.checkDirty()}});this.document.$.styleSheets&&
this.document.$.styleSheets[0]?(a=this.document.$.styleSheets[0],a.insertRule(".cke_editable img {max-width: 50%; max-height: 70%}",0)):(a=this.document.$.createElement("style"),a.innerHTML=".cke_editable img {max-width: 50%; max-height: 70%}",this.document.$.head.appendChild(a))}}};c||(c=a);return CKEDITOR.replace(document.querySelector("#editor"),c,"")};this.isUndefinedOrNull=function(b){return"undefined"===typeof b||null===b};this.checkDirty=function(){if(this.isUndefinedOrNull(h)||this.isUndefinedOrNull(l)||
this.isUndefinedOrNull(m))return!1;var b=this.getTitleFieldValue(),a=Sfdc.get("#notes-save-button");if(b===l&&!h.checkDirty())return a.value=LC.getLabel("ChatterNotesDetailPage","Saved"),a.setAttribute("disabled",!0),!1;""===b?a.setAttribute("disabled",!0):(a.value=LC.getLabel("ChatterNotesDetailPage","Save"),a.removeAttribute("disabled"));return!0};this.createNote=function(b,a,c,d){var f=chatter.getToolbox(),e={};e.retUrl=Sfdc.Url.stripDomainFromUrl(window.location.href);b&&(e.parentId=b);a?(a.retUrl||
(a.retUrl=defaultparams.retUrl),a.parentId||(a.parentId=b)):a=e;g||(g=!0,f.post({url:"/chatternote",params:a,success:function(b,e){g=!1;if(!c){var f=Sfdc.Url.generateUrl(UserContext.getUrl("/"+e.docId),a);navigateToUrl(f)}d&&d(b,e)},failure:function(a,b){g=!1}}))};this.deleteNote=function(b,a){var c=document.querySelector(".notesDetailPage")||document.body,d=new LoadingScreen(c,LC.getLabel("ChatterFileDetailPage","deleteFileMsg")),c=chatter.getToolbox(),f=LC.getLabel("ChatterNotesDetailPage","deleteConfirmation");
return confirm(f)?(d.show(),c.post({url:"/chatterfile/"+b+";delete",id:b,success:function(){a?a.call(this):navigateToUrl(UserContext.getUrl("/_ui/core/chatter/files/FileTabPage"),null,Desktop.CLOSETAB_ACTION)},failure:function(a,b){d.hide();failureCallback&&failureCallback.call(this,a,b)}}),!0):!1};this.cancelNote=function(b){b&&""!==b&&navigateToUrl(decodeURI(b))};this.saveNote=function(){var b=getTitleFieldValue(),a=h.getData(),c=Sfdc.get("#notes-save-button");c.value=LC.getLabel("ChatterNotesDetailPage",
"Saving");c.setAttribute("disabled",!0);var d=this;chatter.getToolbox().post({url:"/chatternote/"+n+";edit",params:{content:a,title:b},success:function(f,e){var g=Sfdc.get(".chatterFileDetailLeftPanel .userInfoPanel .lastModifiedAt");k=new Date;g.innerHTML=LC.getLabel("ChatterNotesDetailPage","LastModifiedTodayAt",Sfdc.Date.formatDate(k,"h:mm a"));c.value=LC.getLabel("ChatterNotesDetailPage","Saved");l=b;m=a;contentVersionId=e.verId;document.title=LC.getLabel("ChatterFileDetailPage","file")+": "+
trim(b)+document.title.substring(document.title.lastIndexOf(" ~ "));h.resetDirty();d.updateLastSaved()},failure:function(a,b){var d=Sfdc.get("#notes-save-container span");Sfdc.Dom.setText(d,LC.getLabel("ChatterNotesDetailPage","SaveFailed"));Sfdc.Dom.addClass(d,"error");c.value=LC.getLabel("ChatterNotesDetailPage","Save");c.removeAttribute("disabled");k=null}})};this.updateLastSaved=function(){var b=Sfdc.get("#notes-save-container span");k&&Sfdc.Dom.setText(b,LC.getLabel("ChatterNotesDetailPage",
"SavedAt",Sfdc.Date.getDateTimeStringFromUserLocale(k)))};return this}();
AccessibleAutoCompleteInputElement=function(a,b,c,d,e,g,f){AutoCompleteInputElement.apply(this,[a,b,c,d,!0,e,g,f]);this.groupedSuggestions=null;null!==this.element&&(this.element.setAttribute("role","combobox"),this.element.setAttribute("aria-autocomplete","list"),this.element.setAttribute("aria-haspopup","true"),this.element.setAttribute("aria-expanded","false"))};AccessibleAutoCompleteInputElement.prototype=new AutoCompleteInputElement;
AccessibleAutoCompleteInputElement.prototype.initACBox=function(){AutoCompleteInputElement.prototype.initACBox.call(this);this.acBox.div.setAttribute("role","listbox")};AccessibleAutoCompleteInputElement.prototype.hideACBox=function(){AutoCompleteInputElement.prototype.hideACBox.call(this);this.element.setAttribute("aria-expanded","false")};
AccessibleAutoCompleteInputElement.prototype.showACBox=function(){AutoCompleteInputElement.prototype.showACBox.call(this);this.element.setAttribute("aria-expanded","true")};AccessibleAutoCompleteInputElement.prototype.handleNav=function(a){KEY_TAB==a.keyCode?this.clearSuggestions():AutoCompleteInputElement.prototype.handleNav.call(this,a)};
AccessibleAutoCompleteInputElement.prototype.selectPrev=function(){if(this.isACBoxVisible()){var a=this.hasValidSelection()?this.selected-1:this.curSuggestions.length-1;0>a?this.deselect():(this.select(a),this.scrollDiv())}};AccessibleAutoCompleteInputElement.prototype.selectNext=function(){this.hasValidSelection()?this.selected+1==this.curSuggestions.length?this.deselect():(this.select((this.selected+1)%this.curSuggestions.length),this.scrollDiv()):this.isACBoxVisible()&&this.select(0)};
AccessibleAutoCompleteInputElement.prototype.select=function(a){this.isACBoxVisible()&&(AutoCompleteInputElement.prototype.select.call(this,a),a=0<=this.selected?Sfdc.get("."+AutoCompleteInputElement.ROW_CSS_CLASS_SELECTED+" .autoCompleteRowLink",this.acBox.div):null,this.element.setAttribute("aria-activedesendant",a&&a.id?a.id:""))};
AccessibleAutoCompleteInputElement.prototype.innerGetSuggestions=function(a){a=AutoCompleteInputElement.prototype.getSuggestions.call(this,a);return[{title:this.displayHeader?LC.getLabel("Sidebar_Search","result_source"):null,suggestions:a}]};
AccessibleAutoCompleteInputElement.prototype.getSuggestions=function(a){var b=[];if(this.groupedSuggestions=this.innerGetSuggestions(a))for(a=0;a<this.groupedSuggestions.length;a++)for(var c=this.groupedSuggestions[a],d=0;d<c.suggestions.length;d++)b.push(c.suggestions[d]);return b};AccessibleAutoCompleteInputElement.prototype.constructACBox=function(a,b){var c=[];this.addSuggestions(c,a,b);this.addFooter(c,!a?0:a.length);return c=this.hook_decorateHtml(c)};
AccessibleAutoCompleteInputElement.prototype.addSuggestions=function(a,b,c){if(null!==this.groupedSuggestions)for(var d=b=0;d<this.groupedSuggestions.length;d++){var e=this.groupedSuggestions[d];this.innerAddSuggestions(a,e.suggestions,c,b,d,e.title);b+=e.suggestions.length}};
AccessibleAutoCompleteInputElement.prototype.innerAddSuggestions=function(a,b,c,d,e,g){Sfdc.assert(Sfdc.isNumber(e),"GroupIndex must be specified, and of type Integer.");this.addMarkupBeforeGroup(a,e);e=this.id+":group"+e;if(g){var f=e+":title";a.push("\x3cdiv role\x3d'group' aria-labelledby\x3d'"+f+"'\x3e");a.push("\x3ch5 class\x3d'autoCompleteSectionRow' id\x3d'"+f+"'\x3e"+g+"\x3c/h5\x3e");a.push("\x3cul role\x3d'presentation' class\x3d'autoCompleteGroup'\x3e")}else a.push("\x3cul role\x3d'group' class\x3d'autoCompleteGroup'\x3e");
for(var f=!0,h=0;h<b.length;h++){var l=b[h];if(l&&l.name){var k=h+d;a.push("\x3cli role\x3d'presentation' ");a.push('onmouseover\x3d"');a.push("AutoCompleteInputElement.mouseOver('"+this.id+"', "+k+')"');a.push('onmouseout\x3d"');a.push("AutoCompleteInputElement.mouseOut('"+this.id+"', "+k+')"');a.push('onclick\x3d"');a.push("AutoCompleteInputElement.click('"+this.id+"', "+k+')"');this.compareSuggestions(c,l)?(a.push("class\x3d'"+AutoCompleteInputElement.ROW_CSS_CLASS_SELECTED+"' "),this.select(k),
f=!1):a.push("class\x3d'"+AutoCompleteInputElement.ROW_CSS_CLASS+"' ");this.getSuggestionWidth()&&a.push(" style\x3d'width:"+this.getSuggestionWidth()+"px' ");a.push("id\x3d'"+AutoCompleteInputElement.getRowIdStatic(this.id,k)+"'\x3e");a.push("\x3ca class\x3d'autoCompleteRowLink' role\x3d'option' tabindex\x3d'-1' id\x3d'"+e+":option"+h+"'\x3e");a.push(this.getSuggestionHtml(l));a.push("\x3c/a\x3e\x3c/li\x3e")}}f&&this.deselect();a.push("\x3c/ul\x3e");g&&a.push("\x3c/div\x3e")};
AccessibleAutoCompleteInputElement.prototype.addMarkupBeforeGroup=function(a,b){};
(function(){function f(c){for(var d,a,b=0,k=c.offsetParent;k;)d=parseInt(c.style.marginLeft,10),isNaN(d)&&(d=0),a=parseInt(c.style.marginRight,10),isNaN(a)&&(a=0),b+=k.offsetWidth-(c.offsetLeft+c.offsetWidth+d+a),c=k,k=c.offsetParent;return b}var d=["online","offline","away"],c={ONLINE:10,OFFLINE:20,AWAY:100,isUmpsReady:function(){return window.umps&&umps.isReady&&!0===umps.isHoverEnabled},getPresence:function(d,g,a){umps.executeAction({method:"umps.presence.getPresenceStatus",data:{entityList:[d]},
callbackFn:function(b){b&&(b.data&&b.data[d]?g.call(a,b.data[d].presence.status):"offline"===b.errorCode&&g.call(a,c.OFFLINE))}})},startChat:function(c,d){umps.executeAction({method:"umps.chat.startChat",data:{entityID:c,chatType:d},callbackFn:function(){}})}};Sfdc.provide("SfdcApp.Chatter.Hover",function(){function e(a){Sfdc.apply(this,a);this.fadingIn=this.fadingOut=null;this.loaded=!1;(this.hover=Sfdc.get(this.id))||this.buildHover();this.hoverContent=Sfdc.get(".wrapper",this.hover);this.hoverChild=
Sfdc.get(".chatterHover",this.hover);this.lastMouseMoveElement=this.chatType=null;this.onAfterShowNowFired=this.onBeforeShowNowFired=this.onAfterHideNowFired=!1;a.hoverItem&&this.initHoverItem(a.hoverItem)}var g=null;Sfdc.apply(e.prototype,{show:function(a){a&&a!==this.hoverItem&&this.initHoverItem(a);if(this.fadingOut)clearTimeout(this.fadingOut),this.fadingOut=null;else if(!this.fadingIn){SfdcApp.ChatterHoverUtil.addChatterCoreCssIfNeeded();var b=this;g?g!==this&&(clearTimeout(g.fadingOut),g.fadingOut=
null,g.hideNow(),this.fadingIn=setTimeout(function(){b.showNow()},0)):this.fadingIn=setTimeout(function(){b.showNow()},800)}},initHoverItem:function(a){this.hoverItem=a;this.defaultDir=this.hoverItem.dir;this.viewport=this.hoverItem.viewport||null;this.moveHoverInDom();this.adjustPosition()},fireEvent:function(a){var b=a+"Fired";this[b]||(chatter.getEventBus().fireEvent("chatter:hover",a,{entityId:this.entityId,domId:this.hoverItem.id,dir:this.defaultDir}),this[b]=!0)},showNow:function(){this.onAfterHideNowFired=
!1;this.loaded||this.loader.load(this.hoverItem,function(a){null===a&&(a=LC.getLabel("Exception","UnhandledException"));Sfdc.Dom.updateHTML(this.hoverContent,a);Util.evalScriptsUnderElement(this.hoverContent);this.loaded=!0;this.adjustPosition()},this);g=this;null!==this.chatType&&this.updateUmps();this.moveHoverInDom();this.addHoverListener(!0);Sfdc.Dom.show(this.hover);this.adjustPosition();this.fireEvent("onAfterShowNow");this.fadingIn=null},moveHoverInDom:function(){if(!Sfdc.userAgent.isIE){var a=
Sfdc.Data.get(this.hover,"SfdcApp.Chatter.Hover.lastUsedBy");if(!a||a!==this.hoverItem.id)Sfdc.Data.set(this.hover,"SfdcApp.Chatter.Hover.lastUsedBy",this.hoverItem.id),this.hoverItem.insertElementAfterItem(this.hover)}},hide:function(){if(this.fadingIn)clearTimeout(this.fadingIn),this.fadingIn=null;else if(!this.fadingOut){var a=this;this.fadingOut=setTimeout(function(){a.hideNow()},400)}},hideNow:function(){g===this&&(g=null);this.addHoverListener(!1);this.chatType&&this.addChatControl("un");this.hover.style.display=
"none";this.fireEvent("onAfterHideNow");this.onAfterShowNowFired=this.onBeforeShowNowFired=!1;this.fadingOut=null},buildHover:function(){this.hover=document.createElement("div");this.hover.id=this.id;this.hover.style.position="absolute";var a=['\x3cdiv class\x3d"chatterHover"\x3e\x3cdiv class\x3d"wrapper"\x3e\x3cdiv class\x3d"loadHover"\x3e',LC.getLabel("Global","loading"),'\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"arrow"\x3e\x3c/div\x3e\x3c/div\x3e'].join("");this.hover.innerHTML=a;document.body.appendChild(this.hover);
Sfdc.Dom.hideByDisplay(this.hover)},invertDirAboveBelow:function(a,b){"chatterHover-above"===this.defaultDir?a=this.isHigh(b)?"chatterHover-below":"chatterHover-above":"chatterHover-below"===this.defaultDir&&(a=this.isLow(b)?"chatterHover-above":"chatterHover-below");return a},invertDirForRtl:function(a){LC.isRtlPage()&&("chatterHover-left"===a?a="chatterHover-right":"chatterHover-right"===a&&(a="chatterHover-left"));return a},adjustPosition:function(){Sfdc.Dom.removeClass(this.hoverChild,["chatterHover-above",
"chatterHover-below","chatterHover-right","chatterHover-left"]);var a=this.hover.style;a.left=a.right="";a.position="absolute";a.zIndex=105;"chatterHover-above"===this.defaultDir||"chatterHover-below"===this.defaultDir?this.setPosAboveBelow():("chatterHover-right"===this.defaultDir||"chatterHover-left"===this.defaultDir)&&this.setPosRightLeft()},setPosAboveBelow:function(){var a=this.hoverItem.getPositionXY();this.hoverContent.style.top=0;this.defaultDir=this.invertDirAboveBelow(this.defaultDir,a);
Sfdc.Dom.addClass(this.hoverChild,this.defaultDir);if(LC.isRtlPage()){var b=this.hover.style;b.left=b.top="100px";a.x-=Sfdc.get(".arrow",this.hoverChild).offsetLeft}Sfdc.Dom.setElementXY(this.hover,[a.x,a.y+("chatterHover-above"===this.defaultDir?-Sfdc.Dom.getHeight(this.hover):this.hoverItem.getHeight())])},setPosRightLeft:function(){var a,b=this.hoverItem.getPositionXY(),c=this.invertDirForRtl(this.defaultDir),d=this.hover.style;Sfdc.Dom.addClass(this.hoverChild,c);d.position="absolute";d.zIndex=
105;a=parseInt(d.top,10);isNaN(a)&&(a=this.hover.offsetTop);d.top=b.y-Sfdc.Dom.getElementXY(this.hover).y+a+"px";"chatterHover-left"===c?d.right=f(this.hoverItem.el)+this.hoverItem.el.offsetWidth-(this.hover.offsetParent?f(this.hover.offsetParent):0)+"px":d.left=b.x+this.hoverItem.el.offsetWidth-(this.hover.offsetParent?Sfdc.Dom.getPositionXY(this.hover.offsetParent)[0]:0)+"px";this.loaded&&(this.isLow(b)?this.hoverContent.style.top=-(-40+Sfdc.Dom.getHeight(this.hoverContent))+"px":this.hoverContent.style.top=
"-20px")},isHigh:function(a){var b=this.viewport&&Sfdc.get(this.viewport);return b?a.y-(Sfdc.Window.getScrollY()||0)<0.5*Sfdc.Dom.getActualHeight(b,!0):a.y-(Sfdc.Window.getScrollY()||0)<0.5*Sfdc.Window.getWindowHeight()},isLow:function(a){var b=this.viewport&&Sfdc.get(this.viewport);return b?a.y-(Sfdc.Window.getScrollY()||0)>0.5*Sfdc.Dom.getActualHeight(b,!0):a.y-(Sfdc.Window.getScrollY()||0)>0.5*Sfdc.Window.getWindowHeight()},updateUmps:function(a){a&&(this.chatType=a);Sfdc.get(".chat",this.hover)?
c.isUmpsReady()?c.getPresence(this.entityId,function(a){var e=Sfdc.select("img.chatStatus",this.hover)[0],g=Sfdc.get(".chat",this.hover);switch(a){case c.AWAY:a="away";break;case c.ONLINE:a="online";break;case c.OFFLINE:a="offline";break;default:this.hideChat();return}Sfdc.Dom.removeClass(g,d);Sfdc.Dom.addClass(g,a);e&&(Sfdc.Dom.removeClass(e,d),Sfdc.Dom.addClass(e,a));"offline"!==a&&this.addChatControl("on")},this):this.hideChat():Sfdc.Function.delay(this.updateUmps,300,this,a)},hideChat:function(){var a=
Sfdc.select("img.chatStatus",this.hover)[0];a&&Sfdc.Dom.hideByVisibility(a);Sfdc.Dom.hideByVisibility(Sfdc.get(".chat",this.hover))},onChatClick:function(){c.startChat(this.entityId,this.chatType)},onChatKeyDown:function(){Sfdc.Event.isKeyAction(evt,Sfdc.Event.keyCode.ENTER)&&c.startChat(this.entityId,this.chatType)},addHoverListener:function(a){var b=Sfdc.userAgent.isIE;a?(Sfdc.on(this.hoverContent,b?"focusin":"focus",this.onFocus,this,!b),Sfdc.on(this.hoverContent,b?"focusout":"blur",this.hide,
this,!b),Sfdc.on(document,"mousemove",this.onMouseMove,this)):(Sfdc.un(this.hoverContent,b?"focusin":"focus",this.onFocus,!b),Sfdc.un(this.hoverContent,b?"focusout":"blur",this.hide,!b),Sfdc.un(document,"mousemove",this.onMouseMove))},onFocus:function(a){this.show(this.hoverItem)},onMouseMove:function(a){a=Sfdc.Event.getEventTarget(a);if(this.lastMouseMoveElement!==a){for(this.lastMouseMoveElement=a;a&&"BODY"!==a.tagName;){if(a===this.hoverContent||a===this.hoverItem.el){this.show(this.hoverItem);
return}a=a.parentNode}this.hide()}},addChatControl:function(a){var b=Sfdc.get(".chat",this.hover);Sfdc[a](b,"click",this.onChatClick,this);Sfdc[a](b,"keydown",this.onChatKeyDown,this)}});Sfdc.apply(e,{getOpenHover:function(){return g},direction:{RIGHT:"chatterHover-right",LEFT:"chatterHover-left",ABOVE:"chatterHover-above",BELOW:"chatterHover-below"}});return e}())})();
(function(){function f(d){d&&(Sfdc.apply(this,d),this.addListeners())}Sfdc.apply(f.prototype,{setListeners:function(d){var c=Sfdc.userAgent.isIE,e=this.getFocusElement();null===e&&Sfdc.log("ChatterHover: element not a link or wrapped in link or containing link. DomId:"+this.el.id);if(this.onShow&&(Sfdc[d](this.el,"mouseover",this.onMouseOver,this),e))Sfdc[d](e,c?"focusin":"focus",this.onMouseOver,this,!c);if(this.onHide&&(Sfdc[d](this.el,"mouseout",this.onHide,this),e))Sfdc[d](e,c?"focusout":"blur",
this.onHide,this,!c)},getFocusElement:function(){return Sfdc.Dom.isMatch(this.el,"a")||0<Sfdc.select("a",this.el).length?this.el:Sfdc.Dom.getParent(this.el,"a")},addListeners:function(){this.setListeners("on")},removeListeners:function(){this.setListeners("un")},onMouseOver:function(){this.purgeTitles();this.onShow()},getHeight:function(){var d=Sfdc.Dom.getHeight(this.el);if(0===d){var c=Sfdc.Dom.getFirstChild(this.el);c&&(d=Sfdc.Dom.getHeight(c))}return d},getWidth:function(){return Sfdc.Dom.getWidth(this.el)},
getPositionXY:function(){return Sfdc.Dom.getElementXY(this.el)},insertElementAfterItem:function(d){var c=Sfdc.Dom.getParent(this.el,"a");c||(c=this.el);c.parentNode.insertBefore(d,c.nextSibling)},purgeTitles:function(){this.shouldPurgeTitles&&(this.el.parentNode.removeAttribute("title"),f.purgeTitles(this.el),this.shouldPurgeTitles=!1)}});f.purgeTitles=function(d){var c,e;if(1===d.nodeType&&!Sfdc.Data.get(d,"SfdcApp.Chatter.Hover.titlePurged")){e=d.childNodes.length;for(c=0;c<e;c++)this.purgeTitles(d.childNodes[c]);
d.removeAttribute("title");Sfdc.Data.set(d,"SfdcApp.Chatter.Hover.titlePurged")}};Sfdc.provide("SfdcApp.Chatter.BaseHoverItem",f)})();
"undefined"!=typeof chatter&&!chatter.getHovers&&function(){function f(a){r.call(this,a)}function d(a){var h=a.dom,b=SfdcApp.MruHovers.getSectionData(h);h.id||(h.id=Sfdc.getUID(h));this.dom=h;this.id=h.id;this.idsInSection=[];this.hoverItems=[];this.registeredHoverItemIds={};this.shouldPurgeTitles=a.shouldPurgeTitles;this.dir=b.dir;this.url=b.url;this.viewport=b.viewport;this.registerHoverItems()}function c(a){var h=s[a];h||(h=new SfdcApp.Chatter.Hover({entityId:a,id:a+"Hover",loader:l}),s[a]=h);
return h}function e(){var a=SfdcApp.Chatter.Hover.getOpenHover();a&&a.hideNow()}function g(){var a=SfdcApp.Chatter.Hover.getOpenHover();a&&a.adjustPosition()}function a(a,h,b){a=Sfdc.Data.get(h,p);t=!0;a?n[a].registerHoverItems():(a=n.push(new d({dom:h,shouldPurgeTitles:b}))-1,Sfdc.Data.set(h,p,a))}function b(a,b,d){chatter.getEventBus().addEventListener(a,b,function(b,h){try{d(b,h)}catch(c){Sfdc.sendGack("CHATTERHOVER",c),Sfdc.Debug.error("chatterHover: Couldn't execute eventListener'",{error:c,
namespace:a,eventname:b,payload:h})}})}function k(){for(;n.length;)n.shift().unregister()}function m(a,b,d,c){a="{namespace: '"+a+"', eventname: '"+(b.eventName?b.eventName:b)+"'}";Sfdc.assert(Sfdc.isDefAndNotNull(d),"_extractHTMLElementFromPayload(): Expected the event "+a+" to have a payload.");d=d[c];Sfdc.assert(Sfdc.isDefAndNotNull(d),"_extractHTMLElementFromPayload(): Expected the payload of the event "+a+" to have the property '"+c+"'.");d=d.dom||d;Sfdc.assert(!!d.tagName,"_extractHTMLElementFromPayload(): Expected the property '"+
c+"' of the payload of the event "+a+" to be either an ExtElement or a HTMLElement.");return d}var s={},u=SfdcApp.MruHovers.SECTION_ATTRIBUTE,v=SfdcApp.MruHovers.SECTION_SELECTOR,w=SfdcApp.MruHovers.ITEM_ATTRIBUTE,x=SfdcApp.MruHovers.ITEM_SELECTOR,q=null,p="SfdcApp.ChatterHover.hsi",n=[],t=!1,r=SfdcApp.Chatter.BaseHoverItem.prototype.constructor;f.prototype=new r;Sfdc.apply(f.prototype,{onShow:function(){Sfdc.Dom.addClass(this.el,"chatter-hover-highlight");if(!q||q.id!==this.section.id)q=this.section;
c(this.entityId).show(this)},onHide:function(){Sfdc.Dom.removeClass(this.el,"chatter-hover-highlight");c(this.entityId).hide(this)}});Sfdc.apply(d.prototype,{getIdsInSection:function(){return this.idsInSection.slice(0)},registerHoverItems:function(){Sfdc.each(Sfdc.select(x,this.dom),function(a){var b=a.id;this.registeredHoverItemIds[b]||(b||(b=a.id="hoverItem"+Sfdc.getUID(a)),a=a.getAttribute(w),-1===this.idsInSection.indexOf(a)&&this.idsInSection.push(a),this.hoverItems.push(new f({el:Sfdc.get(b),
section:this,dir:this.dir,id:b,entityId:a,shouldPurgeTitles:this.shouldPurgeTitles,viewport:this.viewport})),this.registeredHoverItemIds[b]=!0)},this)},unregister:function(){for(;this.hoverItems.length;)this.hoverItems.shift().removeListeners();Sfdc.Data.clear(this.dom,p);SfdcApp.MruHovers.setRegistered(this.dom,null)}});var l={_URL:"/ui/common/MRUHoverLoader",_MAX_IDS_PER_REQUEST:50,_response:"",_loadedEntityIds:{},_buildUrl:function(a,b){var d,c=UserContext.getUrl(l._URL)+"?hoverIds\x3d"+a.join("\x26hoverIds\x3d");
b&&(c+="\x26"+b);c+="\x26isChatterPage\x3d"+("undefined"!==typeof chatter);(d=window.Shepherd)&&c&&(c=d.fixRetUrl(c));return c},_extractResponse:function(a){var b,d;b=l._response;d="\x3c"+a+"\x3e";var c="\x3c/"+a+"\x3e",e=b.indexOf(d),c=b.indexOf(c);-1!==e&&-1!==c?b=b.slice(e+d.length,c):(d=(new Date).getTime(),b=LC.getLabel("Exception","UnhandledException")+"\n"+LC.getLabel("Exception","UnhandledException_errorid")+d,Sfdc.logServer("CHATTERHOVER",Sfdc.Logging.formatError({message:"errorId: "+d+" ChatterHover could not be loaded for entity: "+
a+" [start, end]\x3d["+e+", "+c+"]"}),Sfdc.Logging.LogLevel.INFO));return b},load:function(a,b,d){var c,e,g,f=[],k=l._loadedEntityIds,m=a.section;g=m.getIdsInSection();for(e=0;e<g.length;e++)c=g[e],c!==a.entityId&&!k[c]&&f.push(c);f=f.splice(0,l._MAX_IDS_PER_REQUEST);k[a.entityId]||(f.pop(),f.push(a.entityId));0===f.length?b.call(d,l._extractResponse(a.entityId)):Sfdc.Ajax.request(l._buildUrl(f,m.url),{success:function(c){l._response=l._response.concat(c);for(c=0;c<f.length;c++)l._loadedEntityIds[f[c]]=
!0;b.call(d,l._extractResponse(a.entityId))},failure:function(){b.call(d,null)}})}};chatter.extend("Hovers",function(){return{closeHoverIfShown:e,addUmps:function(a,b){c(a).updateUmps(b)},notify:function(b){var c=null;Sfdc.assert(Sfdc.isDefAndNotNull(b),"chatter.getHovers().notify: element is null or undefined");b.dom&&(b=b.dom);c=b.getAttribute(u)?b:Sfdc.Dom.getParent(b,v);Sfdc.assert(null!==c&&"undefined"!==typeof c,"A hover enabled element has to be placed inside an element with attribute "+u);
a(null,c)},adjustOpenHover:g,dbgRegisterSectionCalled:t}});SfdcApp.MruHovers.registerSection=a;Sfdc.on(window,"load",function(){var c=SfdcApp.MruHovers.registerHovers;b("chatter:feed","onAfterShowMoreFeedItems",function(b,c){Sfdc.assert(Sfdc.isDefAndNotNull(c),"Got null payload from {namespace: chatter:feed, eventname: onAfterShowMoreFeedItems}");for(var d=c.firstFeedItem;d;)a(null,d.dom,!0),d=d.next(".cxfeeditem")});b("unifiedSearchPage:feedSearchResults","onAfterResultsShown",c);b("chatter:feed",
"onAfterFeedRefresh",function(){k();c()});b("chatter:feed","onAfterToggleShow",function(){k();c()});b("chatter:feed","onAfterLoadFromCache",function(){k();c()});b("chatter:feed","onAfterNewPostFeedUpdate",function(b,c){a(null,m("chatter:publisher",b,c,"feedItem"))});b("chatter:feed","onAfterEditPostFeedUpdate",function(b,c){a(null,m("chatter:publisher",b,c,"feedItem"))});b("chatter:hover","onAfterUpdate",function(a,b){chatter.getHovers().notify(m("chatter:hover",a,b,"container"))});b("chatter:publisher",
"onAfterComment",function(a,b){Sfdc.isDefAndNotNull(b.element)&&chatter.getHovers().notify(m("chatter:publisher",a,b,"element"))});b("chatter:publisher","onAfterEditComment",function(a,b){Sfdc.isDefAndNotNull(b.element)&&chatter.getHovers().notify(m("chatter:publisher",a,b,"element"))});b("chatter:files","onAfterDialogOpen",e)})}();
DeflectionAutoComplete=function(b,a,c,d){this.MIN_SEARCH_QUERY_LENGTH=4;DeflectionAutoComplete.superclass.constructor.call(this,b,a,0,c,!0);this.chatter=d;this.displayHeader=!1;this.lastFullSearchInput=null;this.fullSearchCache={};this.fullSearchTriedQueries={}};Ext.extend(DeflectionAutoComplete,AutoCompleteInputElement);DeflectionAutoComplete.prototype.delay=500;DeflectionAutoComplete.prototype.isModalLoaded=!1;DeflectionAutoComplete.prototype.isModalOpen=!1;DeflectionAutoComplete.SQ_BOX_ID="_similarQuestionsBox";
DeflectionAutoComplete.prototype.complete=function(){Sfdc.resolve("Sfdc.servicedeskview")?srcUp(this.getSelectedItemUrl(this.curSuggestions[this.selected].type,!0)):this.showModal()};DeflectionAutoComplete.prototype.getInput=function(){return Sfdc.String.trim(this.element.value).length<this.MIN_SEARCH_QUERY_LENGTH?"":this.element.value};DeflectionAutoComplete.prototype.getCacheKey=function(b){return Sfdc.String.trim(b)};DeflectionAutoComplete.prototype.isValidSuggestion=function(b,a){return!0};
DeflectionAutoComplete.prototype.getSuggestionHtml=function(b){if("KBArticle"===b.type)return this.getArticleHtml(b);if("Question"==b.type)return this.getQuestionHtml(b)};
DeflectionAutoComplete.prototype.getArticleHtml=function(b){var a=[];a.push("\x3cdiv class\x3d'deflectionResultsArticleRow'\x3e");a.push("\x3cimg src\x3d'/s.gif' class\x3d'deflectionResultsIcon deflectionResultsArticleIcon'/\x3e");a.push("\x3cspan class\x3d'deflectionResultsArticleTitle'\x3e\x3ca href\x3d'javascript:void(0);'\x3e");a.push(escapeHTML(b.name));a.push("\x3c/a\x3e\x3c/span\x3e");a.push("\x3c/div\x3e");return a.join("")};
DeflectionAutoComplete.prototype.getQuestionHtml=function(b){var a=[];a.push("\x3cdiv class\x3d'deflectionResultsQuestionRow'\x3e");a.push("\x3cspan class\x3d'deflectionResultsTitleContainer'\x3e");a.push("\x3cimg src\x3d'/s.gif' class\x3d'deflectionResultsIcon deflectionResultsQuestionIcon'/\x3e");a.push("\x3cspan class\x3d'deflectionResultsQuestionTitle'\x3e\x3ca href\x3d'javascript:void(0);'\x3e");a.push(escapeHTML(b.name));a.push("\x3c/a\x3e\x3c/span\x3e");a.push("\x3c/span\x3e");a.push("\x3cspan class\x3d'commentBestAnswerContainer'\x3e");
if(b.dHasBestAnswer){var c=escapeHTML(LC.getLabel("QuestionFeedItemPublisher","QuestionWithBestAnswer"));a.push("\x3cimg src\x3d'/s.gif' class\x3d'deflectionResultsIcon deflectionResultsAnsweredIcon' alt\x3d'");a.push(c);a.push("' title\x3d'");a.push(c);a.push("'/\x3e");a.push('\x3cspan class\x3d"deflectionResultsQuestionAnswered"');a.push("' title\x3d'");a.push(c);a.push("'/\x3e");a.push(escapeHTML(LC.getLabel("QuestionFeedItemPublisher","Answered")));a.push("\x3c/span\x3e")}c=1==b.dCommentCount?
LC.getLabel("Feeds_QuestionPost","CommentsSummarySingular"):LC.getLabel("Feeds_QuestionPost","CommentsSummaryPlural",b.dCommentCount);a.push("\x3cimg src\x3d'/s.gif' class\x3d'deflectionResultsCommentCountIcon'/\x3e");a.push('\x3cspan class\x3d"deflectionResultsCommentCount" title\x3d"');a.push(c);a.push('"/\x3e');a.push(b.dCommentCount);a.push("\x3c/span\x3e");a.push("\x3c/span\x3e");a.push("\x3c/div\x3e");return a.join("")};
DeflectionAutoComplete.prototype.showSpinner=function(){this.initSpinner();this.spinner&&Sfdc.Dom.show(this.spinner)};DeflectionAutoComplete.prototype.hideSpinner=function(){this.initSpinner();this.spinner&&Sfdc.Dom.hideByDisplay(this.spinner)};DeflectionAutoComplete.prototype.initSpinner=function(){this.spinner||(this.spinner=Sfdc.get(".publisherSpinnerPlaceholder",Sfdc.Dom.getParent(this.element,"div.deflectionPanel")))};
DeflectionAutoComplete.prototype.hideSQBox=function(){if(this.sqBox){var b=Sfdc.get(this.id+DeflectionAutoComplete.SQ_BOX_ID,Sfdc.get(".publisherDeflectionPlaceholder"));Sfdc.Dom.hideByDisplay(b)}};DeflectionAutoComplete.DIALOG_ID="ChatterDeflectionModal";
DeflectionAutoComplete.prototype.showModal=function(){if(!this.element||!this.hasValidSelection()&&!this.isSQBoxVisible()||!this.curSuggestions||!this.curSuggestions[this.selected])return!1;var b=this,a,c=this.curSuggestions[this.selected].type;a=this.curSuggestions[this.selected].queryId;var d=this.curSuggestions[this.selected].dId,e="KBArticle"===c?escapeHTML(this.curSuggestions[this.selected].dTitle):LC.getLabel("QuestionFeedItemPublisher","SuggestedQuestions"),h="KBArticle"===c?"articleTitleSuggestions":
"recordSuggestionsByName",f="0px",k=this.getSelectedItemUrl(c,!1),g="";a&&Sfdc.logServer("search",{format:"SEASC",recordId:d,searchString:this.lastInput,position:this.selected,suggestionType:h,queryId:a});if("KBArticle"==c)g='\x3cdiv class\x3d"articleFullLinkDiv"\x3e\x3ca class\x3d"articleFullLink"  href\x3d"'+Sfdc.Url.generateUrl(this.curSuggestions[this.selected].urlLink,{popup:"true",inModalDisplay:"false"})+'" target\x3d"_blank"\x3e'+LC.getLabel("KBArticleDeflection","KBArticleFullLink")+"\x3c/a\x3e\x3c/div\x3e";
else if("Question"==c)f="10px";else return!1;DeflectionAutoComplete.dialog||(a=new OverlayDialog,a.id=DeflectionAutoComplete.DIALOG_ID,a.setWidth(730),a.setMinHeight(400),a.register(),a.setTitle(e),a.cancel=function(a){b.isModalLoaded=!1;b.isModalOpen=!1;Sfdc.Dom.removeClass(document.body,"DeflectionAutoCompleteOverlayBackground");this.hide();a&&(b.clearACBox(),b.focused=!0,b.clearCache(),b.displaySuggestions());b.element.focus()},a.addEvents(),DeflectionAutoComplete.dialog=a);a=[];a.push('\x3ciframe id\x3d"ModalIframe" frameborder\x3d"no" src\x3d"'+
k+'" style\x3d"border:0;height:400px;width:100%;" '+("KBArticle"===c?"onload\x3dDeflectionAutoComplete.redirect(this.contentWindow.location)":"")+"\x3e\x3c/iframe\x3e"+g);Sfdc.Dom.setStyles(Sfdc.get(DeflectionAutoComplete.dialog.id+"Content"),{paddingRight:"0px",paddingLeft:f,paddingBottom:"0px",border:"0px",overflow:"hidden"});if(dialogContent=Ext.get(DeflectionAutoComplete.dialog.id+"Content"))this.isModalOpen=!0,dialogContent.update(a.join("")),DeflectionAutoComplete.dialog.setTitle(e),DeflectionAutoComplete.dialog.show(),
Sfdc.Dom.addClass(document.body,"DeflectionAutoCompleteOverlayBackground");return!0};
DeflectionAutoComplete.prototype.getSelectedItemUrl=function(b,a){var c;"KBArticle"==b?c=Sfdc.Url.generateUrl(this.curSuggestions[this.selected].urlLink,{popup:"true",inModalDisplay:!a}):"Question"==b&&(c=Sfdc.Url.generateUrl(chatter.getToolbox().sitePrefix()+"/_ui/ui/deflection/QuestionModalPage",{subjectId:chatter.getFeed().getConfig().subjectId,fId:this.curSuggestions[this.selected].dId,inModalDisplay:"true",feedType:chatter.getFeed().getConfig().feedType}));a&&(c=Sfdc.Url.generateUrl(c,{isdtp:"vw"}));
return c};DeflectionAutoComplete.redirect=function(b){DeflectionAutoComplete.prototype.isModalLoaded&&window.parent.open(b,"_top");DeflectionAutoComplete.prototype.isModalLoaded=!0};Sfdc.onReady(function(){chatter.getEventBus().addEventListener("chatter:feed","onAfterDeleteFeedItem",function(b,a){var c;window.parent.sfdcPage&&(c=window.parent.sfdcPage.getDialogById(DeflectionAutoComplete.DIALOG_ID));c&&c.cancel(!0)})});DeflectionAutoComplete.prototype.getRequestParams=function(){return{subjectId:this.chatter.getFeed().getConfig().subjectId}};
DeflectionAutoComplete.prototype.blurCallback=function(){var b=this;b.focused=!1;if(!b.acBoxFocused&&!b.isModalOpen){var a=b.getOnBlurDelay(),c=function(){b.clearACBox();b.displayFullSearchSuggestions(b.getInput())};0<a?setTimeout(c,a):c()}};DeflectionAutoComplete.prototype.acBoxMouseOutHandler=function(){this.acBoxFocused=!1};DeflectionAutoComplete.prototype.onAfterTabDown=function(b){this.hasValidSelection()||(this.clearSuggestions(),this.acBoxFocused=!1,this.blurCallback(this))};
DeflectionAutoComplete.prototype.displayFullSearchSuggestions=function(b){this.beforeShowFullSearchSuggestions();!this.element||!this.enabled||!this.additionalDisplayConditionsValid(b)?(this.clearSQBox(),this.hideNoResultsMessage()):b==this.lastFullSearchInput&&this.isSQBoxVisible()||(this.lastFullSearchInput=b,this.curSuggestions=this.getSuggestions(b,{fullSearch:!0}),this.updateSQBox(b,this.curSuggestions))};
DeflectionAutoComplete.prototype.updateSQBox=function(b,a){if(this.element)if(!a||0===a.length){if(this.clearSQBox(),this.additionalDisplayConditionsValid(b)){var c=this.getCacheKey(b);if(this.fullSearchTriedQueries[c])this.onEmptyFullSearchSuggestions(c)}}else this.displaySQBox(a)};
DeflectionAutoComplete.prototype.displaySQBox=function(b){this.sqBox||this.initSQBox();var a=this.constructACBox(b);a.splice(1,0,'\x3ctr\x3e\x3ctd\x3e\x3cdiv class\x3d"deflectionResultsHeader"\x3e'+LC.getLabel("QuestionFeedItemPublisher","DeflectionResultsHeader")+"\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e ");this.sqBox.div.innerHTML=a.join("");this.positionSQBox();this.setSQBoxHeight(!b?0:b.length);this.sqBox.setStyle("display","block");Sfdc.Effects.rollIn(this.sqBox.div,null,{duration:400})};
DeflectionAutoComplete.prototype.setSQBoxHeight=function(b){var a=this.getMaxSuggestionsToDisplay();b>a?(this.sqBox.setStyle("height",this.getACBoxHeight(a)),this.scrolling=!0):(this.sqBox.setStyle("height","auto"),this.scrolling=!1)};DeflectionAutoComplete.prototype.clearSQBox=function(){this.sqBox&&this.isSQBoxVisible()&&(this.hideSQBox(),this.sqBox.setStyle("height","auto"),this.sqBox.div.innerHTML="")};
DeflectionAutoComplete.prototype.initSQBox=function(){this.element&&(this.sqBox=document.createElement("div"),this.sqBox.id=this.id+DeflectionAutoComplete.SQ_BOX_ID,this.sqBox.className=this.getACBoxCSSClass(),this.addSQBoxToPage(this.sqBox),this.sqBox=new IframeShim(this.sqBox),this.sqBox.setStyle("width",this.getMinimumWidth()+"px"))};DeflectionAutoComplete.prototype.getACBoxCSSClass=function(){return DeflectionAutoComplete.superclass.getACBoxCSSClass.call()+" chatterQuestionSQTABox"};
DeflectionAutoComplete.prototype.isSQBoxVisible=function(){return this.sqBox&&"none"!=this.sqBox.getStyle("display")};DeflectionAutoComplete.prototype.addSQBoxToPage=function(b){Sfdc.get(".publisherDeflectionPlaceholder",Sfdc.Dom.getParent(this.element,"div.deflectionPanel")).appendChild(b)};DeflectionAutoComplete.prototype.positionSQBox=function(){this.element&&this.sqBox&&(this.sqBox.setStyle("position","relative"),this.sqBox.setStyle("width","auto"))};
DeflectionAutoComplete.prototype.updateWidth=function(){};DeflectionAutoComplete.prototype.getMaxSuggestionsToDisplay=function(){return 7};DeflectionAutoComplete.prototype.getNoResultsMessage=function(){this.noResultsMessage||(this.noResultsMessage=Sfdc.get(".publisherDeflectionNoResultsPlaceholder",Sfdc.Dom.getParent(this.element,"div.deflectionPanel")));return this.noResultsMessage};DeflectionAutoComplete.prototype.showNoResultsMessage=function(){this.getNoResultsMessage()&&Sfdc.Dom.show(this.getNoResultsMessage())};
DeflectionAutoComplete.prototype.hideNoResultsMessage=function(){this.getNoResultsMessage()&&Sfdc.Dom.hideByDisplay(this.getNoResultsMessage())};DeflectionAutoComplete.prototype.beforeShowFullSearchSuggestions=function(){this.hideSpinner();this.hideNoResultsMessage()};DeflectionAutoComplete.prototype.onEmptyFullSearchSuggestions=function(b){this.hideSpinner();this.additionalDisplayConditionsValid(b)&&this.showNoResultsMessage()};
DeflectionAutoComplete.prototype.additionalDisplayConditionsValid=function(b){if((b=chatter.getPublisher().getHandler("QuestionPost"))&&Sfdc.isFunction(b.isTitleEmptyOrPrompt)){var a=this.getInput();return!b.isTitleEmptyOrPrompt(a)}return DeflectionAutoComplete.superclass.additionalDisplayConditionsValid()};DeflectionAutoComplete.prototype.hook_show=function(){this.isSQBoxVisible()&&this.clearSQBox();this.hideNoResultsMessage()};
DeflectionAutoComplete.prototype.checkCacheOrRetrieve=function(b,a){return a&&a.fullSearch?this.checkFullSearchCacheOrRetrieve(b,a):DeflectionAutoComplete.superclass.checkCacheOrRetrieve.apply(this,arguments)};
DeflectionAutoComplete.prototype.checkFullSearchCacheOrRetrieve=function(b,a){var c=this.getCacheKey(b);if(!this.fullSearchCache[c]&&c&&c.length>=this.minSuggestLen&&!this.fullSearchTriedQueries[c]){var d=this,e=this.getParamsForServlet(c)||{};e.fullSearch=!0;d.hideNoResultsMessage();d.showSpinner();this.innerRetrieveFromServlet(function(a){if(a&&(a=d.parseResponse(a))&&a[AbstractAutoCompleteServlet.SUGGESTIONS])if(d.fullSearchTriedQueries[c]=!0,a=a[AbstractAutoCompleteServlet.SUGGESTIONS],d.fullSearchCache[c]=
a,d.displayFullSearchSuggestions(c),0===a.length)d.onEmptyFullSearchSuggestions(c)},{data:e})}return this.fullSearchCache[c]};
Sfdc.provide("SfdcApp.InfluenceInfoHover",{hover:null,getHover:function(a,b){this.hover||(a.id=Sfdc.getUID(a),SfdcApp.Chatter.BaseHoverItem.purgeTitles(a),this.hover=new SfdcApp.Chatter.Hover({entityId:b,id:"InflHov-"+a.id,hoverItem:new SfdcApp.Chatter.BaseHoverItem({entityId:b,el:a,dir:SfdcApp.Chatter.Hover.direction.RIGHT,id:a.id}),loader:{load:function(a,c,d){chatter.getToolbox().post({url:"/influence/info/"+b,success:function(a,b){c.call(d,b.html)},failure:function(){c.call(d,null)}})}}}));return this.hover},
show:function(a,b){this.getHover(a,b).show()},hide:function(a,b){this.getHover(a,b).hide()}});
PublisherAutoComplete=function(a,b,c,d,e,g,f,h,k,m){this.MIN_HASHTAG_QUERY_LENGTH=this.MIN_MENTION_QUERY_LENGTH=2;this.MIN_HASHTOPIC_QUERY_LENGTH=3;PublisherAutoComplete.superclass.constructor.call(this,a,b,-1,c,!0);this.groupAtMentionsEnabled=e;this.hashTopicEnabled=g;this.hashtagACDisabled=f;this.feedItemId=d;this.ajaxState="none";this.atMentions=[];this.atMentionLogEntries=[];this.isLoggingMentionSelection=!1;this.logTimeSinceLastChar=this.logOverallSelectionTime=0;this.atMentionPattern={start:"@[",
end:"]"};this.atMentionEncodePattern={start:"{"+PublisherAutoComplete.MENTION_KEY,end:"}"};this.hashMentionPattern={start:"#[",end:"]"};this.deniedUsers=[];this.textUtil=chatter.getTextUtil();this.activeAtMention={hasMention:!1};this.feedItemParentId=h;this.feedItemParentName=k;this.currentRequestId=0;this.feedItemVisibility=m;this.fetchingPage=!1;b=chatter.getEventBus();b.addEventListener("chatter:publisher","onAfterUpdateStatus",this.clearMruCache);b.addEventListener("chatter:publisher","onAfterComment",
this.clearMruCache);this.indexStartAC=-1;this.isOverlay=!1;Sfdc.on(this.element,"mouseup",function(){this.activeAtMention=this.isMention("inside")},this);this.feedSubjectId=function(){var a=chatter.getFeed().config;return d&&a&&a.subjectId?a.subjectId:h}();this.textareaId=a};Ext.extend(PublisherAutoComplete,AutoCompleteInputElement);
PublisherAutoComplete.prototype.clearMruCache=function(a){PublisherAutoComplete.acCache.cache&&(PublisherAutoComplete.acCache.cache[PublisherAutoComplete.MRU_CACHE_KEY]=null);PublisherAutoComplete.acCache.retryNextQuery=!0};PublisherAutoComplete.prototype.focus=function(){this.element.focus()};PublisherAutoComplete.prototype.getValue=function(){return this.textUtil.getValue(this.element)};PublisherAutoComplete.prototype.setValue=function(a){this.element.value=a||""};
PublisherAutoComplete.prototype.setFocusedValue=function(a,b,c){this.element.value=a+b+(Sfdc.isEmpty(c)?" ":c)};PublisherAutoComplete.prototype.isRichText=function(){return!1};PublisherAutoComplete.prototype.getFocusedValue=function(){return this.getValue()};PublisherAutoComplete.prototype.clearAtMentions=function(){this.atMentions=[];this.deniedUsers=[];this.atMentionLogEntries=[];this.isLoggingMentionSelection=!1};PublisherAutoComplete.prototype.getInputWithEncodedAtMentions=function(){return this.replaceMentions(this.getValue())};
PublisherAutoComplete.prototype.replaceMentions=function(a){for(var b=this.atMentions,c=b.length-1;0<=c;c--){var d=b[c],e=this.createMention(d),g=a.lastIndexOf(e),f=e.length;0<=g&&(e=a.substring(0,g),a=a.substring(g+f),a=e+this.encodeMention(d)+a)}return a.replace(/\u200f/g,"").replace(/\u200e/g,"")};PublisherAutoComplete.prototype.setIsOverlay=function(a){this.isOverlay=a};PublisherAutoComplete.prototype.onfocus=function(){this.focused=!0};PublisherAutoComplete.IS_RTL="rtl"==Ext.select("html").item(0).getAttribute("dir");
PublisherAutoComplete.MAX_SUGGESTIONS=11;PublisherAutoComplete.BOX_CSS_CLASS=AutoCompleteInputElement.BOX_CSS_CLASS+" publisherAC_box";PublisherAutoComplete.ROW_CSS_CLASS=AutoCompleteInputElement.ROW_CSS_CLASS+" publisherAC_row";PublisherAutoComplete.ROW_CSS_CLASS_SELECTED=AutoCompleteInputElement.ROW_CSS_CLASS_SELECTED+" publisherAC_row";PublisherAutoComplete.ROW_CSS_CLASS_MOUSE_OVER=PublisherAutoComplete.ROW_CSS_CLASS+" publisherAC_row_hover";
PublisherAutoComplete.TITLE_ROW_CSS_CLASS=AutoCompleteInputElement.TITLE_ROW_CSS_CLASS+" publisherAC_title";PublisherAutoComplete.TITLE_ROW_CSS_CLASS_SELECTED="publisherAC_title_selected";PublisherAutoComplete.TITLE_ROW_CSS_CLASS_CLICKABLE="publisherAC_clickableTitle publisherAC_hr";PublisherAutoComplete.HELP_TEXT_CSS_CLASS=AutoCompleteInputElement.TITLE_ROW_CSS_CLASS+" publisherAC_help";PublisherAutoComplete.LIST_CSS_CLASS="publisherAC_list";PublisherAutoComplete.AUTOFETCH_LOADING_CSS_CLASS="autofetchloading";
PublisherAutoComplete.prototype.setACBoxHeight=function(a){var b=this.getMaxSuggestionsToDisplay(),c=!this.isACMention;a>b?(a=b*(AutoCompleteInputElement.ROW_HEIGHT+0.1),c&&(a=a+2.1+2.3),a+=AutoCompleteInputElement.ROW_HEIGHT_UNITS,this.acBox.setStyle("height",a),this.scrolling=!0):(this.acBox.setStyle("height","auto"),this.scrolling=!1)};
PublisherAutoComplete.prototype.updateACBox=function(a,b){this.element&&(!a||0===a.length?this.acBox&&this.clearACBox():(this.acBox||this.initACBox(),this.displayACBox(a,b),this.loadingScreen=new LoadingScreen(Sfdc.get("."+PublisherAutoComplete.AUTO_FETCH_LOADING_CSS_CLASS,this.acBox.div),LC.getLabel("Global","loading")),0===this.currentPageFetch&&(this.curSuggestions&&this.curSuggestions.length<PublisherAutoComplete.AUTO_FETCH_PAGE_SIZE)&&(this.allResultsReturned=!0),this.curSuggestions&&(0<this.curSuggestions.length&&
0===this.currentPageFetch)&&this.select(0),this.scrollDiv(),this.updateWidth()))};PublisherAutoComplete.prototype.showACBox=function(){"block"!=this.acBox.getStyle("display")&&(this.acBox.setStyle("display","block"),this.announcementDone=!1)};
PublisherAutoComplete.prototype.constructACBox=function(a,b){var c=["\x3col class\x3d'"+PublisherAutoComplete.LIST_CSS_CLASS+"'\x3e"];this.addSuggestions(c,a,b,0);0===a.length&&this.addEmptyRow(c,LC.getLabel("PublisherAutoComplete","noResults"));c.push("\x3c/ol\x3e");c.push("\x3cdiv class\x3d'"+PublisherAutoComplete.AUTO_FETCH_LOADING_CSS_CLASS+"'\x3e\x3c/div\x3e");return c};PublisherAutoComplete.prototype.addEmptyRow=function(a,b){a.push('\x3cli\x3e\x3cdiv class\x3d"publisherAC_noMatch"\x3e'+b+"\x3c/div\x3e\x3c/li\x3e")};
PublisherAutoComplete.prototype.addSuggestions=function(a,b,c,d){if(b)for(var e=!this.isACMention&&this.hashTopicEnabled?" topicName":"",g=0,f=b.length;g<f;g++){var h=b[g];if(h&&(h.UserName||h.value)){var k=g+d;a.push("\x3cli\x3e");a.push("\x3cdiv ");a.push('onmouseover\x3d"');a.push("PublisherAutoComplete.mouseOver('"+this.id+"', "+k+')"');a.push('onmouseout\x3d"');a.push("PublisherAutoComplete.mouseOut('"+this.id+"', "+k+')"');a.push('onmousedown\x3d"');a.push("PublisherAutoComplete.click(event,'"+
this.id+"', "+k+');"');this.compareSuggestions(c,h)?(a.push("class\x3d'"+PublisherAutoComplete.ROW_CSS_CLASS_SELECTED+"' "),this.select(k)):a.push("class\x3d'"+PublisherAutoComplete.ROW_CSS_CLASS+"' ");a.push("id\x3d'"+AutoCompleteInputElement.getRowIdStatic(this.id,k)+"'\x3e\x3cspan class\x3d'acName"+e+"'\x3e");a.push(this.getSuggestionHtml(h));!this.isACMention&&h.desc&&a.push("\x3c/span\x3e\x3cspan class\x3d'acInfo topicInfo'\x3e"+h.desc);a.push("\x3c/span\x3e\x3c/div\x3e");a.push("\x3c/li\x3e")}}};
PublisherAutoComplete.prototype.addHeader=function(a,b,c){c?a.push('\x3cli\x3e\x3cdiv class\x3d"'+PublisherAutoComplete.TITLE_ROW_CSS_CLASS+' publisherAC_hr"\x3e'+b+"\x3c/div\x3e\x3c/li\x3e"):a.push('\x3cli\x3e\x3cdiv class\x3d"'+PublisherAutoComplete.TITLE_ROW_CSS_CLASS+'"\x3e'+b+"\x3c/div\x3e\x3c/li\x3e")};
PublisherAutoComplete.prototype.positionACBox=function(a){if(this.element&&this.acBox&&(!a||this.isACBoxVisible())){a=Sfdc.Dom.getElementXY(this.element);var b=a.y+this.element.offsetHeight;this.acBox.setStyle("left",a.x+"px");this.acBox.setStyle("top",b+"px");a=this.getACWidth();this.acBox.setStyle("width",a+"px");"object"===typeof Ext&&(a=Ext.get("massEdit"),null!==a&&this.acBox.setStyle("zIndex",parseFloat(a.getStyle("z-index"),10)+10))}};
PublisherAutoComplete.prototype.removeClassBridge=function(a,b){var c=b.split(" ");if(1<c.length)for(var d=0;d<c.length;d++)a.removeClass(c[d]);else a.removeClass(c)};PublisherAutoComplete.prototype.select=function(a){var b=null;0<=this.selected&&(b=this.getRowEl(this.selected))&&this.removeClassBridge(b,AutoCompleteInputElement.ROW_CSS_CLASS_SELECTED);this.selected=a;(b=this.getRowEl(a))&&b.addClass(AutoCompleteInputElement.ROW_CSS_CLASS_SELECTED)};PublisherAutoComplete.prototype.selectNext=function(){this.cycleSelection(!0)};
PublisherAutoComplete.prototype.selectPrev=function(){this.cycleSelection(!1)};PublisherAutoComplete.prototype.cycleSelection=function(a){if(this.hasValidSelection()){var b=a?this.selected+1:this.selected-1;a?this.select(b>=this.curSuggestions.length?0:b):this.select(0>b?this.curSuggestions.length-1:b);this.scrollDiv()}};
PublisherAutoComplete.prototype.initACBox=function(){if(this.element){this.acBox=document.createElement("div");var a=this;addEvent(this.acBox,"mouseover",function(){a.acBoxFocused=!0});addEvent(this.acBox,"mouseout",function(){a.acBoxFocused=!1;a.onClickFired||(a.element.focus(),a.focused=!0)});addEvent(this.acBox,"scroll",function(){var b=a.acBox.div,d=Sfdc.Dom.getActualHeight(b,!0),e=Sfdc.Dom.getHeight(b),b=Sfdc.get(b).scrollTop;if((shouldAutoFetchMore=e+b>PublisherAutoComplete.AUTO_FETCH_SCALE_LIMIT*
d)&&!a.fetchingPage&&!a.allResultsReturned)a.currentPageFetch+=1,a.currentPageFetch>PublisherAutoComplete.MAX_AUTO_FETCHES||(a.fetchingPage=!0,a.loadingScreen.show(),a.appendResults=!0,a.appendPageFromCacheOrServlet(a.lastInput))});this.acBox.id=this.id+AutoCompleteInputElement.BOX_ID;this.acBox.className=PublisherAutoComplete.BOX_CSS_CLASS;this.addACBoxToPage(this.acBox);this.acBox=new IframeShim(this.acBox);this.acBox.setStyle("width",this.getMinimumWidth()+"px");if(this.isOverlay){var b=Ext.get(this.element).parent(".overlayDialog").getStyle("z-index");
this.acBox.setStyle("zIndex",b+10)}AutoCompleteInputElement.hasResizeHandler||(addEvent(window,"resize",AutoCompleteInputElement.resizeHandler),AutoCompleteInputElement.hasResizeHandler=!0)}};PublisherAutoComplete.prototype.getMinimumWidth=function(){return this.element.clientWidth+10};
PublisherAutoComplete.prototype.complete=function(){if(!this.element||!this.curSuggestions)return!1;var a=this.curSuggestions[this.selected];if(!a&&this.isACMention)return!1;a&&this.isACMention&&(this.atMentions.push(a),this.logMentionSelection(a));a=this.innerComplete(a);this.setCaretLocation(a);this.indexStartAC=-1;this.clearACBox();this.resizeTextArea();return!0};
PublisherAutoComplete.prototype.logMentionSelection=function(a){if(this.isLoggingMentionSelection){var b=(new Date).getTime();this.atMentionLogEntries.push({mentioneeId:a.UserId,overallSelectionInt:b-this.logOverallSelectionTime,lastCharSelectionInt:b-this.logTimeSinceLastChar,lastPrefix:this.getWordToComplete(),selectionPosition:this.selected});this.isLoggingMentionSelection=!1}};PublisherAutoComplete.prototype.getMentionLogEntries=function(){return this.atMentionLogEntries};
PublisherAutoComplete.prototype.innerComplete=function(a){var b=this.getWordToComplete();if(!this.isACMention&&!a&&this.element&&b&&1<b.length)a=this.insertNode({value:this.formatTopicName(b.substring(1))},this.getCaretLocation());else{if(!this.element||!a||0===a.length)return;a=this.insertNode(a,this.getCaretLocation())}this.clearSuggestions();return a};PublisherAutoComplete.prototype.getCaretLocation=function(){return this.textUtil.getCaretLocation(this.element)};
PublisherAutoComplete.prototype.setCaretLocation=function(a){this.textUtil.setCaretLocation(this.element,a)};
PublisherAutoComplete.prototype.insertNode=function(a,b){var c=this.getFocusedValue(),d,e;this.isACMention?(this.checkCanReadFeed(a),d=c.lastIndexOf(this.getWordToComplete(),b-1),e=this.createMention(a)):(this.hashTopicEnabled?(d=b-this.lastInput.length,"["===c.charAt(d)&&d--,"]"===c.charAt(b)&&b++):d=c.lastIndexOf("#",b-1),e=this.createHashtag(a));if(-1===d)return b;this.setFocusedValue(c.substring(0,d),e,c.substring(b));Sfdc.userAgent.isIE&&(d=c.substring(0,d).replace(/\r\n/g,"n").length);return d+
e.length};
PublisherAutoComplete.prototype.retrieveFromServlet=function(a){if(!a)return!1;if("#"===a.charAt(0)||"@"===a.charAt(0))a=a.charAt(0)+Sfdc.String.trim(a.substring(1));a=Sfdc.String.trim(a);if(this.isACMention&&a.length<this.MIN_MENTION_QUERY_LENGTH||!this.isACMention&&this.hashTopicEnabled&&a.length<this.MIN_HASHTOPIC_QUERY_LENGTH||!this.isACMention&&!this.hashTopicEnabled&&a.length<this.MIN_HASHTAG_QUERY_LENGTH)return!1;this.requestParams[AbstractAutoCompleteServlet.pINPUT]=a.substring(1);this.requestParams[PublisherAutoComplete.PARAM_LOOKUP_TYPE]=
this.isACMention?PublisherAutoComplete.LOOKUP_TYPE_MENTION:PublisherAutoComplete.LOOKUP_TYPE_HASHTAG;this.requestParams[PublisherAutoComplete.PARAM_PAGE_NUM]=this.currentPageFetch;this.requestParams[PublisherAutoComplete.PARAM_PAGE_SIZE]=PublisherAutoComplete.AUTO_FETCH_PAGE_SIZE;!this.isACMention&&!this.hashTopicEnabled&&(this.requestParams[PublisherAutoComplete.PARAM_HASHTAG_LIST_TYPE]=PublisherAutoComplete.acCache.cache[PublisherAutoComplete.MRU_CACHE_KEY]?PublisherAutoComplete.HASHTAG_LIST_TYPE_POPULAR_HASHTAGS:
PublisherAutoComplete.HASHTAG_LIST_TYPE_BOTH);var b=this,c=this.getCacheKey(a),d=this.currentRequestId+1;this.currentRequestId=d;delay=PublisherAutoComplete.REQUEST_DELAY;this.isACMention&&a.length==this.MIN_MENTION_QUERY_LENGTH&&(delay=PublisherAutoComplete.REQUEST_DELAY_LONG);setTimeout(function(){d===b.currentRequestId&&(PublisherAutoComplete.acCache.triedQueries[c]=!0,b.requestParams.feedItemId=b.feedItemId,b.requestParams.feedSubjectId=b.feedSubjectId,b.requestParams.groupAtMentionsEnabled=b.groupAtMentionsEnabled,
b.ajaxState="initialized",chatter.getToolbox().get({url:b.servletURI,params:b.requestParams,success:function(c,d){b.ajaxState="finished";b.isACMention?b.saveToCache(a,d[PublisherAutoComplete.MENTION_RESULTS]):b.hashTopicEnabled?b.saveToCache(a,d.suggestions):b.saveToCache(a,d[PublisherAutoComplete.POPULAR_TAGS],d[PublisherAutoComplete.MY_HASH_TAGS]);b.fetchingPage=!1;b.appendResults?b.appendSuggestions():b.displaySuggestions(!0)},failure:function(c,d){b.ajaxState="finished";b.isACMention||b.hashTopicEnabled&&
b.saveToCache(a,[]);b.displaySuggestions(!0)}}))},delay);return!0};PublisherAutoComplete.prototype.handleInput=function(a){Sfdc.Event.isKeyAction(a,[KEY_ARROW_U,KEY_ARROW_D])||(this.currentPageFetch=0,this.allResultsReturned=this.fetchingPage=this.appendResults=!1);AutoCompleteInputElement.prototype.handleInput.call(this,a)};
PublisherAutoComplete.prototype.displaySuggestions=function(a){if(this.element&&this.focused&&(!a||this.isACMention||this.isACBoxVisible())){var b;if(a)b=this.lastInput;else{if(!this.isACMention){b=this.getFocusedValue();var c=PublisherAutoComplete.getWordToCompleteStartIndex(b,this.getCaretLocation());0<=this.indexStartAC&&(0<=c&&c!=this.indexStart)&&(this.indexStartAC=c,b.charAt(this.indexStartAC)===PublisherAutoComplete.MENTION_KEY&&(this.isACMention=!0))}b=this.getWordToComplete();b==PublisherAutoComplete.MENTION_KEY?
(this.logOverallSelectionTime=(new Date).getTime(),this.isLoggingMentionSelection=!0):b.substring(0,1)==PublisherAutoComplete.MENTION_KEY&&1<b.length&&(this.logTimeSinceLastChar=(new Date).getTime())}this.isACMention||"["===b.charAt(1)&&(b="#"+b.substring(2));if(!this.hashtagACDisabled||this.isACMention){var c=this.isACMention&&this.hasReachedMaxMentions(),d=this.isNoticeDisplayed("limitMention");if(c!==d){if(c){this.showNotice("limitMention",LC.getLabel("PublisherAutoComplete","limitMention",PublisherAutoComplete.MAX_MENTION));
return}this.hideNotice("limitMention")}this.displaySuggestionsFor(b,a)}}};PublisherAutoComplete.prototype.isNoticeDisplayed=function(a){return chatter.getTextareaMessageUtil().isMessageDisplayed(this.textareaId,a)};PublisherAutoComplete.prototype.showNotice=function(a,b,c){chatter.getTextareaMessageUtil().showMessage({el:this.textareaId,type:c||2,append:!0,msg_html:b,msg_id:a})};
PublisherAutoComplete.prototype.hideNotice=function(a){return chatter.getTextareaMessageUtil().hideMessage({el:this.textareaId,msg_id:a})};
PublisherAutoComplete.prototype.displaySuggestionsFor=function(a,b){if(b||a!=this.lastInput||!this.isACBoxVisible())if(this.lastInput=a,""===a)this.indexStartAC=-1,this.clearSuggestions();else if(!this.isACMention&&this.hashTopicEnabled&&(a.match("^#\\s")||a.length>1+PublisherAutoComplete.TOPIC_LENGTH||3<a.split(" ").length||0<a.search("\\s\\s+")||0<a.search("[\\.,\\]]")))this.clearSuggestions();else if(1==a.length)this.displayHelpACBox();else{var c=null;this.hasValidSelection()&&(c=this.curSuggestions[this.selected]);
this.curSuggestions=this.getSuggestions(a);this.curSuggestions.not_in_cache||(this.updateACBox(this.curSuggestions,c),this.announcementDone||(this.announcementDone=!0))}};PublisherAutoComplete.prototype.getAjaxState=function(){return this.ajaxState};PublisherAutoComplete.prototype.formatTopicName=function(a){a=Sfdc.String.trim(a).split(/\s+/);for(var b=0;b<a.length;b++)a[b]=a[b].charAt(0).toUpperCase()+a[b].substr(1);return a.join(" ")};
PublisherAutoComplete.prototype.getSuggestions=function(a){var b=this.checkCacheOrRetrieve(a);if(!b)return{not_in_cache:1};b=this.getValidSuggestions(a,b);if(!this.isACMention&&this.hashTopicEnabled){var c=this.getCaseInsensitivetMatch(a,b);0>c?b.splice(0,0,{value:this.formatTopicName(a.substring(1)),desc:LC.getLabel("TopicsFeed","new")}):0<c&&(a=b.splice(c,1)[0],b.splice(0,0,a));b.length>PublisherAutoComplete.TOPICS_DISPLAYED&&(b=b.splice(0,PublisherAutoComplete.TOPICS_DISPLAYED))}return b};
PublisherAutoComplete.prototype.getCaseInsensitivetMatch=function(a,b){var c,d=Sfdc.String.trim(a.substring(1).toLowerCase());for(c=0;c<b.length;c++)if(d===b[c].value.toLowerCase())return c;return-1};PublisherAutoComplete.prototype.getMaxSuggestionsToDisplay=function(){return PublisherAutoComplete.MAX_SUGGESTIONS};
PublisherAutoComplete.prototype.getCacheKey=function(a){return this.isACMention?this.currentPageFetch+a:this.hashTopicEnabled?PublisherAutoComplete.HASHTAG_KEY+Sfdc.String.trim(a):PublisherAutoComplete.HASHTAG_KEY+a.charAt(1)};PublisherAutoComplete.prototype.saveToCache=function(a,b,c){a=this.getCacheKey(a);PublisherAutoComplete.acCache.cache[a]=b;c&&0<c.length&&(PublisherAutoComplete.acCache.cache[PublisherAutoComplete.MRU_CACHE_KEY]=c)};
PublisherAutoComplete.prototype.clearCache=function(){PublisherAutoComplete.acCache.cache={};PublisherAutoComplete.acCache.triedQueries={}};
PublisherAutoComplete.prototype.checkCacheOrRetrieve=function(a){var b=this.getCacheKey(Sfdc.String.trim(a));if(this.isACMention||this.hashTopicEnabled){if(PublisherAutoComplete.acCache.triedQueries[b])return PublisherAutoComplete.acCache.cache[b]}else if(!0===PublisherAutoComplete.acCache.retryNextQuery&&(PublisherAutoComplete.acCache.retryNextQuery=!1,PublisherAutoComplete.acCache.triedQueries[b]=null),PublisherAutoComplete.acCache.triedQueries[b])return this.getCache(b);this.retrieveFromServlet(a);
return!1};PublisherAutoComplete.prototype.getCache=function(a){if(this.isACMention||this.hashTopicEnables)return PublisherAutoComplete.acCache.cache[a];var b=[];a=PublisherAutoComplete.acCache.cache[a];var c=PublisherAutoComplete.acCache.cache[PublisherAutoComplete.MRU_CACHE_KEY];a&&(b=b.concat(a));c&&(b=b.concat(c));return b};
PublisherAutoComplete.prototype.handleNav=function(a){this.isACBoxVisible()&&(AutoCompleteInputElement.isNav(a)?(a.keyCode==KEY_ESC?this.clearSuggestions():a.keyCode==KEY_ARROW_U?this.selectPrev():a.keyCode==KEY_ARROW_D?this.selectNext():a.keyCode==KEY_TAB?this.handleEnter(a):a.keyCode==KEY_ENTER&&this.handleEnter(a),AutoCompleteInputElement.captureKeystroke(a)):a.keyCode==KEY_PROCESS&&(this.inKeyIME=!0))};
PublisherAutoComplete.prototype.isMention=function(a){var b=this.atMentionPattern,c=this.getFocusedValue();chatter.getTextUtil();var d=this.getCaretLocation(),e;switch(a){case "right":if(c.charAt(d-1)==b.end)for(a=d-1;0<=a;){if(c.charAt(a)==b.start.charAt(1)&&c.charAt(a-1)==b.start.charAt(0))return{hasMention:!0,startPos:a,endPos:d};a--}return{hasMention:!1};case "left":if(c.charAt(d)==b.start.charAt(0)&&c.charAt(d+1)==b.start.charAt(1)){a=d+2;for(e=c.length;a<e;){if(c.charAt(a)==b.end)return{hasMention:!0,
startPos:d+1,endPos:a+1};a++}}return{hasMention:!1};case "inside":for(a=d;0<a;){if(c.charAt(a)!=b.end){if(c.charAt(a)==b.start.charAt(1)&&c.charAt(a-1)==b.start.charAt(0)){e=!0;break}}else{e=!1;break}a--}if(e){j=d;for(e=c.length;j<e;){if(c.charAt(j)==b.end)return{hasMention:!0,startPos:a,endPos:j+1};j++}}return{hasMention:!1}}};
PublisherAutoComplete.prototype.showNotificationIfNeeded=function(){0<this.deniedUsers.length?this.showNotice("userNotHaveAccess",this.getPermissionErrorMessage()):this.hideNotice("userNotHaveAccess");this.atMentions.length<PublisherAutoComplete.MAX_MENTION&&this.hideNotice("limitMention")};PublisherAutoComplete.prototype.handleEnter=function(a){this.complete()&&this.shouldCaptureKeyStroke?AutoCompleteInputElement.captureKeystroke(a):this.clearSuggestions()};
PublisherAutoComplete.mouseOver=function(a,b){var c=AutoCompleteInputElement.getInstance(a);c&&b!=c.selected&&(document.getElementById(AutoCompleteInputElement.getRowIdStatic(a,b)).className=PublisherAutoComplete.ROW_CSS_CLASS_MOUSE_OVER)};PublisherAutoComplete.mouseOut=function(a,b){var c=AutoCompleteInputElement.getInstance(a);c&&b!=c.selected&&(document.getElementById(AutoCompleteInputElement.getRowIdStatic(a,b)).className=PublisherAutoComplete.ROW_CSS_CLASS)};
PublisherAutoComplete.click=function(a,b,c){AutoCompleteInputElement.captureKeystroke(a);Ext.isIE7?PublisherAutoComplete.clickDefered.defer(20,{},[b,c]):PublisherAutoComplete.clickDefered(b,c)};PublisherAutoComplete.clickDefered=function(a,b){var c=AutoCompleteInputElement.getInstance(a);c.select(b);c.complete()};PublisherAutoComplete.prototype.isValidSuggestion=function(a,b){var c=this.getRegexForInput(Sfdc.String.trim(a.substring(1)));return this.isACMention?!0:b.value.match(c)};
PublisherAutoComplete.prototype.getRegexForInput=function(a){var b=a.toLowerCase();AutoCompleteInputElement.regexCache[b]||(AutoCompleteInputElement.regexCache[b]=this.matchBlanks?RegExp(["(\\b|^|\\W)(",AutoCompleteInputElement.escapeRegex(a),")"].join(""),"gi"):RegExp(["(^)(",AutoCompleteInputElement.escapeRegex(a),")"].join(""),"gi"));return AutoCompleteInputElement.regexCache[b]};
PublisherAutoComplete.prototype.getSuggestionHtml=function(a){return this.isACMention?this.getMentionSuggestionHtml(a):this.getHashTagSuggestionHtml(a)};PublisherAutoComplete.prototype.findInput=function(a){return a};PublisherAutoComplete.prototype.compareSuggestions=function(a,b){return a&&b&&a.UserId&&b.UserId&&b.UserId==a.userId};
PublisherAutoComplete.prototype.scrollDiv=function(){if(this.hasValidSelection()&&this.scrolling){var a=this.acBox.div,b=Sfdc.Dom.getActualHeight(a,!0),c=Sfdc.Dom.getHeight(a);Sfdc.get(a);if(Sfdc.userAgent.isIE7){!PublisherAutoComplete.pageScrollHeight&&0<b&&(PublisherAutoComplete.pageScrollHeight=b,PublisherAutoComplete.heightPerSuggestion=PublisherAutoComplete.pageScrollHeight/this.curSuggestions.length);var a=PublisherAutoComplete.heightPerSuggestion,d=this.curSuggestions.length*PublisherAutoComplete.heightPerSuggestion;
d>b-a&&d<b+a||(b=d);0!==b%PublisherAutoComplete.pageScrollHeight&&(b=(this.currentPageFetch+1)*PublisherAutoComplete.pageScrollHeight);b>PublisherAutoComplete.pageScrollHeight*(PublisherAutoComplete.MAX_AUTO_FETCHES+1)&&(b=PublisherAutoComplete.pageScrollHeight*(PublisherAutoComplete.MAX_AUTO_FETCHES+1))}this.acBox.div.scrollTop=b*((this.selected+1)/this.curSuggestions.length)-0.5*c}};PublisherAutoComplete.prototype.getPosition=function(){return Sfdc.Dom.getElementXY(this.element)};
PublisherAutoComplete.prototype.getACWidth=function(){return Sfdc.userAgent.isIE8?Sfdc.Dom.getWidth(this.element):this.element.clientWidth};PublisherAutoComplete.MENTION_KEY="@";PublisherAutoComplete.HASHTAG_KEY="#";PublisherAutoComplete.LIST_CSS_CLASS="publisherAC_list";PublisherAutoComplete.AUTO_FETCH_LOADING_CSS_CLASS="autofetchloading";PublisherAutoComplete.PARAM_LOOKUP_TYPE="LookupType";PublisherAutoComplete.LOOKUP_TYPE_MENTION="ATMENTIONS";PublisherAutoComplete.LOOKUP_TYPE_HASHTAG="HASHTAGS";
PublisherAutoComplete.PARAM_HASHTAG_LIST_TYPE="HashtagListType";PublisherAutoComplete.PARAM_PAGE_NUM="PageNum";PublisherAutoComplete.PARAM_PAGE_SIZE="PageSize";PublisherAutoComplete.HASHTAG_LIST_TYPE_BOTH="BOTH";PublisherAutoComplete.HASHTAG_LIST_TYPE_POPULAR_HASHTAGS="POPULARHASHTAGS";PublisherAutoComplete.LICENSE_COUNT="LicenseCount";PublisherAutoComplete.MENTION_RESULTS="mentionSearchResults";PublisherAutoComplete.MY_HASH_TAGS="MyHashTags";PublisherAutoComplete.POPULAR_TAGS="PopularHashTags";
PublisherAutoComplete.MAX_MENTION=25;PublisherAutoComplete.MAX_SUGGESTIONS_IN_RESPONSE=100;PublisherAutoComplete.MRU_CACHE_KEY="##mru";PublisherAutoComplete.TOPIC_LENGTH=99;PublisherAutoComplete.TOPICS_DISPLAYED=3;PublisherAutoComplete.REQUEST_DELAY=300;PublisherAutoComplete.REQUEST_DELAY_LONG=1E3;PublisherAutoComplete.AUTO_FETCH_SCALE_LIMIT=0.7;PublisherAutoComplete.MAX_AUTO_FETCHES=9;PublisherAutoComplete.AUTO_FETCH_PAGE_SIZE=50;
PublisherAutoComplete.prototype.checkCanReadFeed=function(a){var b=this,c=a.UserId;a=chatter.getFeed().config;var d;if("005"===c.substring(0,3)&&(b.feedItemParentId?d=b.feedItemParentId:a&&(d=a.subjectId),d&&"TOPIC"!==a.feedType)){var e=function(a){for(var d=b.atMentions,e=d.length-1;0<=e;e--)if(d[e].UserId==c){a||b.deniedUsers.push(d[e]);break}a||(b.hideNotice("userNotHaveAccess"),b.showNotice("userNotHaveAccess",b.getPermissionErrorMessage()))};d=["/feed/",d,"/",a.feedType,"/checkaccess/",c].join("");
chatter.getToolbox().get({url:d,params:{visibility:this.feedItemVisibility},success:function(a,b){!1===b[c]?e(!1):e(!0)},failure:function(a,b){e(!0)}})}};PublisherAutoComplete.prototype.updateParent=function(a,b){this.feedItemParentId=a;this.feedItemParentName=b;this.recheckAccess()};
PublisherAutoComplete.prototype.cleanAtMentions=function(){for(var a=this.atMentions,b=this.getInputWithEncodedAtMentions(),c=[],d,e,g=a.length-1;0<=g;g--)d=a[g],e=b.lastIndexOf(this.encodeMention(d)),0<=e&&c.push(d);this.atMentions=c};PublisherAutoComplete.prototype.updateFeedItemVisibility=function(a){this.feedItemVisibility=a;this.recheckAccess()};
PublisherAutoComplete.prototype.recheckAccess=function(){var a=this;this.deniedUsers=[];this.cleanAtMentions();this.hideNotice("userNotHaveAccess");if(this.feedItemParentId){var b=this.atMentions,c=b.length,d="";if(0<c)for(var e=0;e<c;e++)"005"===b[e].UserId.substring(0,3)&&(""!==d&&(d+=","),d+=b[e].UserId);""!==d&&chatter.getToolbox().get({url:"/feed/checkaccess/"+this.feedItemParentId,params:{idsToCheck:d,visibility:this.feedItemVisibility},success:function(d,e){for(var h=c-1;0<=h;h--)"false"===
e[b[h].UserId]&&a.deniedUsers.push(b[h]);0<a.deniedUsers.length&&a.showNotice("userNotHaveAccess",a.getPermissionErrorMessage())}})}};
PublisherAutoComplete.prototype.getPermissionErrorMessage=function(){var a=this.deniedUsers,b="",c=[],b={};for(i=0;i<a.length;i++)b[a[i].UserName]||(b[a[i].UserName]=a[i],c.push(b[a[i].UserName]));var d=this.feedItemVisibility,b=function(){var a,b=c.length;a=!d||chatter.getPublisher().FEEDITEM_VISIBILITY_ALL_USERS===d?1===b?LC.getLabel("PublisherAutoComplete","allCannotReadNoEntitySingular"):LC.getLabel("PublisherAutoComplete","allCannotReadNoEntityPlural"):1===b?LC.getLabel("PublisherAutoComplete",
"internalExternalCannotSeeUpdateSingular"):LC.getLabel("PublisherAutoComplete","internalExternalCannotSeeUpdatePlural");if(1===b)return a.replace("{0}",c[0].UserName);if(2===b)return a=a.replace("{0}",c[0].UserName),a.replace("{1}",c[1].UserName);for(var b="",f=0;f<c.length-1;)b+=c[f].UserName+", ",f++;b=b.substring(0,b.length-1);a=a.replace("{0}",b);return a.replace("{1}",c[c.length-1].UserName)}();return escapeHTML(b)};PublisherAutoComplete.prototype.getNumInsertedMentions=function(){return this.atMentions.length};
PublisherAutoComplete.prototype.getNumValidMentions=function(){for(var a=0,b=this.getValue(),c=this.atMentions,d=this.atMentionPattern,e=c.length-1;0<=e;e--){var g=d.start+c[e].UserName+d.end,f=b.lastIndexOf(g);0<=f?(l=g.length,b=b.substr(0,f)+b.substr(f+l),a++):this.atMentions.splice(e,1)}return a};PublisherAutoComplete.prototype.hasReachedMaxMentions=function(){return this.getNumInsertedMentions()>=PublisherAutoComplete.MAX_MENTION?this.getNumValidMentions()>=PublisherAutoComplete.MAX_MENTION:!1};
PublisherAutoComplete.prototype.createMention=function(a){var b=this.atMentionPattern;return b.start+a.UserName+b.end};PublisherAutoComplete.prototype.encodeMention=function(a){var b=this.atMentionEncodePattern;return b.start+a.UserId+b.end};PublisherAutoComplete.prototype.createHashtag=function(a){var b=this.hashMentionPattern;return this.hashTopicEnabled?b.start+a.value+b.end:a.value};
PublisherAutoComplete.prototype.displayHelpACBox=function(){this.element&&(this.acBox||this.initACBox(),this.setACBox(this.getACHelpHTML()),this.positionACBox(),this.setACBoxHeight(1),this.showACBox(),this.updateWidth())};
PublisherAutoComplete.prototype.getACHelpHTML=function(){if(this.isACMention){var a=this.groupAtMentionsEnabled?LC.getLabel("PublisherAutoComplete","typeMentionUserAndGroup"):LC.getLabel("PublisherAutoComplete","typeMentionUserOnly");return['\x3cdiv class\x3d"',PublisherAutoComplete.HELP_TEXT_CSS_CLASS,'"\x3e',a,"\x3c/div\x3e"]}return['\x3cdiv class\x3d"',PublisherAutoComplete.HELP_TEXT_CSS_CLASS,'"\x3e',LC.getLabel("PublisherAutoComplete","typeSomethingHashTag"),"\x3c/div\x3e"]};
PublisherAutoComplete.prototype.getHashTagSuggestionHtml=function(a){var b=Sfdc.String.trim(escapeHTML(this.lastInput));a=escapeHTML(a.value);b=this.getRegexForInput(b.substring(1));return a.replace(b,'$1\x3cstrong class\x3d"autocompleteMatch"\x3e$2\x3c/strong\x3e')};
PublisherAutoComplete.prototype.getMentionSuggestionHtml=function(a){var b=escapeHTML(this.lastInput),c=escapeHTML(a.UserName),d=escapeHTML(a.Title),b=this.getRegexForInput(b.substring(1)),c=c.replace(b,'$1\x3cstrong class\x3d"autocompleteMatch"\x3e$2\x3c/strong\x3e');return[a.ImageHtml,"\x26nbsp;\x3cspan class\x3d'name'\x3e",c,"\x3c/span\x3e",a.BadgeHtml,a.OutOfOfficeMessageHtml," \x3cspan class\x3d'publisherAC_userRole'\x3e",d,"\x3c/span\x3e"].join("")};
PublisherAutoComplete.prototype.getRowEl=function(a){return Ext.get(AutoCompleteInputElement.getRowIdStatic(this.id,a))};PublisherAutoComplete.prototype.toggleEnabled=function(a){a?chatter.getToolbox().enable(this.element):chatter.getToolbox().disable(this.element)};
PublisherAutoComplete.prototype.getWordToComplete=function(){var a=this.getFocusedValue(),b=this.getCaretLocation(),c=PublisherAutoComplete.getWordToCompleteStartIndex(a,b);if(this.isACBoxVisible()){var d=a.charAt(this.indexStartAC);return-1===c||this.isACMention&&d!=PublisherAutoComplete.MENTION_KEY||!this.isACMention&&d!=PublisherAutoComplete.HASHTAG_KEY?"":a.slice(this.indexStartAC,b)}return 0<=c?(this.indexStartAC=c,a=a.slice(this.indexStartAC,b),0<a.length&&(a.charAt(0)==PublisherAutoComplete.MENTION_KEY?
this.isACMention=!0:this.isACMention=!1),a):""};PublisherAutoComplete.prototype.getAtMentionsPlainTextCount=function(a){var b=0,c=a.length;if(0!==c){for(var d=0;d<c;d++)b+=a[d].UserName.length;b+=this.atMentionPattern.start.length*c;b+=this.atMentionPattern.end.length*c}return b};
PublisherAutoComplete.prototype.getInputValueLength=function(){var a=0;this.element&&(this.atMentions&&0<this.atMentions.length)&&(a=21*this.atMentions.length-this.getAtMentionsPlainTextCount(this.atMentions));return this.getValue().length+a};PublisherAutoComplete.prototype.toggleExternalGroupWarning=function(a){var b=Ext.get(this.element.id);b&&a?b.addClass("externalGroupInput"):b.removeClass("externalGroupInput")};
PublisherAutoComplete.prototype.appendPageFromCacheOrServlet=function(a){this.currentPageFetch>PublisherAutoComplete.MAX_AUTO_FETCHES?this.fetchingPage=!1:this.checkCacheOrRetrieve(a)&&this.appendSuggestions()};
PublisherAutoComplete.prototype.appendSuggestions=function(){if(this.element){var a=this.lastInput,b=this.isACMention&&this.hasReachedMaxMentions(),c=this.isNoticeDisplayed("limitMention");if(b!==c){if(b){this.showNotice("limitMention",LC.getLabel("PublisherAutoComplete","limitMention",PublisherAutoComplete.MAX_MENTION));return}this.hideNotice("limitMention")}b=null;this.hasValidSelection()&&(b=this.curSuggestions[this.selected],a=this.getSuggestions(a),this.curSuggestions.push.apply(this.curSuggestions,
a),acList=Sfdc.get("."+PublisherAutoComplete.LIST_CSS_CLASS,this.acBox.div),c=[],this.addSuggestions(c,a,b,this.currentPageFetch*PublisherAutoComplete.AUTO_FETCH_PAGE_SIZE),acList.innerHTML+=c.join(""),this.loadingScreen.hide(),this.fetchingPage=!1,this.curSuggestions.length<(this.currentPageFetch+1)*PublisherAutoComplete.AUTO_FETCH_PAGE_SIZE&&(this.allResultsReturned=!0),Sfdc.userAgent.isIE7&&(PublisherAutoComplete.pageScrollHeight&&(acList.style.height=PublisherAutoComplete.pageScrollHeight*(this.currentPageFetch+
1)),a=0>=this.currentPageFetch-1?1:this.currentPageFetch-1,a=a*PublisherAutoComplete.AUTO_FETCH_PAGE_SIZE*PublisherAutoComplete.AUTO_FETCH_SCALE_LIMIT,this.selected+1>a&&this.scrollDiv()))}};PublisherAutoComplete.isValidBefore=function(a){return"\u00a0"==a||-1!=" .,;:)(\x26!'\"`?|\\\n%-_+\x3d$^~[]{}\x3c\x3e*\t\u200f\u200e\u200b".indexOf(a)};PublisherAutoComplete.acCache={cache:{},triedQueries:{}};
PublisherAutoComplete.getWordToCompleteStartIndex=function(a,b){for(var c=0,d,e=!0,g=!0,f=b-1;0<=f&&(e||g);f--)if(d=a.charAt(f),/\s/.test(d))c++,3<=c&&(g=e=!1);else if("]"==d)e=!1;else if(d==PublisherAutoComplete.MENTION_KEY){if(e&&(0===f||PublisherAutoComplete.isValidBefore(a.charAt(f-1))))return f}else if(d==PublisherAutoComplete.HASHTAG_KEY&&g&&(0===f||PublisherAutoComplete.isValidBefore(a.charAt(f-1))))return f;return-1};
function getRechatParent(b){return Ext.get("rechatBodyContainer"+b)}function removeCustomerGroupMessage(b){b=getRechatParent(b);b.child("div.selectionBlock").removeClass("customerGroup");chatter.getToolbox().hide(b.child(".customerGroupMessage"))}
function RechatHelper(b,c,g,k){var d=this,f=chatter.getToolbox(),a=getRechatParent(c),e=function(b,d){var e=a.child(".rechatResponseMessage");e.update(b);e.addClass(d);f.hide(a.child(".rechatBody"));f.show(a.child(".rechatResponseMessageContainer"))};this.dialogContents=a;this.feedItemId=b;this.shareButton=a.child(".rechatShareButton");this.shareButton.removeAllListeners();this.shareButton.on("click",function(){d.submit()});Sfdc.userAgent.isIE7&&(Sfdc.on(this.shareButton.dom,"mouseover",function(){Sfdc.Dom.addClass(d.shareButton.dom,
"onHover")}),Sfdc.on(this.shareButton.dom,"mouseout",function(){Sfdc.Dom.removeClass(d.shareButton.dom,"onHover")}));this.textarea=a.child("textarea.cxrechatcommenttextarea").dom;this.isContentPost=a.child(".rechatSharing");this.fireOnAfterPreviewLoaded=function(){chatter.getEventBus().fireEvent("chatter:rechat","onAfterPreviewLoaded",{})};this.commit=function(){var b=d.dialogContents.child("textarea.cxrechatcommenttextarea").dom;f.disable(b);var a=chatter.getFeed().getCommentElement(b.id),c;a&&(c=
a.getInputWithEncodedAtMentions());a={newParentId:d.getParentId(),commentText:c};c=k?(window.opener?window.opener:window.parent).chatter:chatter;var g=c.getEventBus(),h=c.getFeed(),l="NEWS"===h.config.feedType&&(!h.filter||"all"===h.filter);l&&(a.showNewFeedItem=!0,a.feedType=h.getConfig().feedType,a.pollingToken=chatter.getFeed().getPollToken(),g.fireEvent("chatter:feed","onBeforeRechat"));f.disableButton(d.shareButton.dom);f.post({url:"/feeditems/"+d.feedItemId+"/rechats",params:a,success:function(b,
a){var c=d.createSuccessMessage(a.parentDetailURL);e(c,"success");l&&a.feedItem&&(g.fireEvent("chatter:feed","onBeforeNewPostFeedUpdate",{json:a}),c=h.addFeedItem(a.feedItem),chatter.getFeed().displayShowMoreAndFadeOutForFeedItemElement(c.getAttribute("id"),c),g.fireEvent("chatter:feed","onAfterNewPostFeedUpdate",{json:a,feedItem:c}))},failure:function(a,c){f.enable(b);f.enableButton(d.shareButton);c&&(c.errors&&c.errors.rechatErrorMessage)&&e(c.errors.rechatErrorMessage,"failed")}})};this.closeDialog=
function(){(k?window.opener?window.opener:window.parent:window).chatter.getModalOverlay(g).closeDialog()};this.submit=function(){d.commit()};this.updateCommentArea=function(a,c){var b=chatter.getFeed().getCommentElement(d.textarea.id);a||(c=a="");if(b)b.updateParent(a,c);else{var b=Sfdc.get(".cxfeeditem",d.dialogContents.dom),e=chatter.getFeed().getFeedItemData(b);e.parentid=a;e.parentname=c;e=Sfdc.JSON.stringify(e);b.setAttribute("data-feeditem",e)}};this.getParentId=function(){return null};this.createSuccessMessage=
function(a){return null}}Ext.ns("Sfdc.RechatComposer.RechatToFollowersHelper");
Sfdc.RechatComposer.RechatToFollowersHelper=function(b,c,g,k,d){Sfdc.RechatComposer.RechatToFollowersHelper.superclass.constructor.call(this,b,c,g,d);var f=chatter.getToolbox();f.enableButton(this.shareButton.dom);removeCustomerGroupMessage(c);this.updateCommentArea(UserContext.userId,LC.getLabel("Publisher","UserLabel"));this.getParentId=function(){return k};this.createSuccessMessage=function(a){var b=f.htmlEncode(LC.getLabel("Feeds","RechatSuccessToFollowers"));return LC.getLabel("Feeds","RechatSuccessMessage",
a,b,b,b)}};Ext.extend(Sfdc.RechatComposer.RechatToFollowersHelper,RechatHelper);Ext.ns("Sfdc.RechatComposer.RechatToGroupHelper");
Sfdc.RechatComposer.RechatToGroupHelper=function(b,c,g,k){var d,f;function a(a){f=d=null;Ext.get("recipientSelectionContainer"+a)&&Ext.get("recipientSelectionContainer"+a).parent().remove();r.setDisplayed(!0);removeCustomerGroupMessage(a);n();q();h.updateCommentArea()}function e(a,b){var d=LC.getLabel("Publisher","GroupRemoveBtn");return"\x3cdiv id\x3d'recipientSelectionContainer"+c+"' class\x3d'recipientSelectionContainer'\x3e\x3cdiv class\x3d'rechatGroupicon'\x3e"+b.replace("chatter-avatarMedium",
"chatter-avatarSmall")+"\x3c/div\x3e\x3cdiv class\x3d'rechatGroupinfo'\x3e"+a+"\x3c/div\x3e\x3cdiv class\x3d'removegroup'\x3e\x3ca href\x3d'#' class\x3d'remove' title\x3d'"+d+"'\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e"}function n(){var a=chatter.getToolbox(),b=d;b?chatter.getTextareaMessageUtil().enableSubmitButtonIfNoErrorsInternal(h.textarea.id,h.shareButton.dom):a.disableButton(h.shareButton);return b}function q(){var a=Ext.get(l);a.addClass("ghostText");a.dom.value=LC.getLabel("Feeds","RechatWithGroupGhostText")}
function s(a){a=getRechatParent(a);a.child("div.selectionBlock").addClass("customerGroup");chatter.getToolbox().show(a.child(".customerGroupMessage"))}function t(a,b,c,g,k,l){null===d&&(d=a,f=b,m.parent(),r.setDisplayed(!1),u.createChild({tag:"div",cls:"grpSelect",html:e(b,g)}).select(".remove").addListener("click",function(a,b){h.removeRecipient(l);a.stopEvent();a.stopPropagation()}),k&&s(l),n(),m.blur(),h.updateCommentArea(a,LC.getLabel("Publisher","CollaborationGroupLabel")))}Sfdc.RechatComposer.RechatToGroupHelper.superclass.constructor.call(this,
b,c,g,k);b=getRechatParent(c);var h=this;g=chatter.getToolbox();f=d=null;var l="rechatRecipientInputBox"+c,m=b.child(".rechatRecipientInput"),p=b.child(".rechatRecipientListCls"),r=b.child(".rechatRecipientsContainer"),u=b.child(".rechatRecipientSelector");b.child(".recipientSelectionContainer")&&a(c);this.updateCommentArea();g.disableButton(h.shareButton.dom);new UserAndGroupAutoCompleteInputElement({elementId:l,zIndex:6E4,inDialog:!0,disableGhostText:!0,entityType:UserAndGroupAutoCompleteInputElement.ENTITY_TYPE_GROUP,
fixedACYPosition:0,handleBlur:function(){this.clearSuggestions()},handleSelect:function(a){t(a.itemId,a.itemName,a.itemTitle,a.imageHtml,a.isExternalUserOrGroup,c);this.complete()},getACXPosition:function(){return p.getX()},getACYPosition:function(){return p.getY()+p.getHeight()},getMinimumWidth:function(){return 350}});m.on({keydown:{fn:function(a){a.keyCode==KEY_TAB&&shareButton.focus()}},focus:{fn:function(){m.addClass("focus")}},blur:{fn:function(){m.removeClass("focus");q()}}});this.createSuccessMessage=
function(a){var b=f;return LC.getLabel("Feeds","RechatSuccessMessage",a,b,b,b)};this.submit=function(){n()&&h.commit()};this.getParentId=function(){return d};this.removeRecipient=function(b){a(b)}};Ext.extend(Sfdc.RechatComposer.RechatToGroupHelper,RechatHelper);Ext.ns("Sfdc.RechatComposer.RechatTargetSelector");
Sfdc.RechatComposer.RechatTargetSelector=function(b,c,g,k,d,f){var a=chatter.getToolbox(),e=getRechatParent(g);"followers"==b?(a.hide(e.child(".rechatViaLink")),a.show(e.child(".followersAndGroupContainer")),a.hide(e.child(".rechatWithGroup")),Sfdc.RechatComposer.RechatToFollowersHelper(c,g,k,d,f)):"group"==b?(a.show(e.child(".rechatWithGroup")),Sfdc.RechatComposer.RechatToGroupHelper(c,g,k,f)):"link"==b?(a.show(e.child(".rechatViaLink")),a.hide(e.child(".followersAndGroupContainer")),e.child(".rechatUrlCls").dom.focus()):
"backtoprevious"==b&&(a.hide(e.child(".rechatViaLink")),a.show(e.child(".followersAndGroupContainer")));return!1};
(function(){function k(a,b){return a?Sfdc.get(".chatterListOverlay"):Sfdc.get(".chatterListOverlay",Sfdc.get(b))}function f(a,b,e,c,d,g,h){var f=Sfdc.get(".chatterListOverlayContents",k(a,b)),l=chatter.getToolbox();l.get({url:c,params:{q:d,i:e,keyPrefix:g,pageNumber:h,dialogId:b},success:function(a,b){Sfdc.Dom.updateHTML(f,b.html);l.fixIE7Haslayout(f)}})}Sfdc.provide("SfdcApp.Chatter.FollowListOverlay",{closeDialog:function(a){chatter.getToolbox().get({params:{q:";updatefollowing",id:a},success:function(b,
a){var c=Sfdc.get("followingPanel"),d=c.ownerDocument.createElement("div");d.innerHTML=Sfdc.String.trim(a.html);c.parentNode.insertBefore(d.firstChild,c);Sfdc.Dom.removeChild(c)}})},prevPage:function(a,b,e,c,d,g,h){f(a,b,e,c,d,g,h-1)},nextPage:function(a,b,e,c,d,g,h){f(a,b,e,c,d,g,h+1)},filter:function(a,b,e,c){var d=Sfdc.get(".picklistFilter",k(a,b));f(a,b,e,null,c,d.value,0)}})})();
(function(){function c(a,b,d,e){var c=Sfdc.get(".chatterListOverlayContents",!a?Sfdc.get(".chatterListOverlay",Sfdc.get(b)):Sfdc.get(".chatterListOverlay")),f=chatter.getToolbox();f.get({url:d,params:e,success:function(a){Sfdc.Dom.updateHTML(c,a.responseText);f.fixIE7Haslayout(c)}})}Sfdc.provide("SfdcApp.Chatter.GroupListOverlay",{closeDialog:function(a,b){return(a?window.opener?window.opener:window.parent:window).sfdcPage.getDialogById(b).cancel()},nextPage:function(a,b,d,e){c(a,b,d,{p:e+1})},prevPage:function(a,
b,d,e){c(a,b,d,{p:e-1})}})})();
(function(){SfdcApp.Chatter.SubscribeButton={_toggle:function(d,b){var a=Sfdc.select("\x3e *",d),c=a[0],a=a[1];Sfdc.Dom.show(b?a:c);Sfdc.Dom.hideByDisplay(b?c:a)},onHover:function(d,b){var a=Sfdc.Event.getEventTarget(d,"."+ZenCss.mediaBody);a&&(a=Sfdc.get(a,".chatter-unfollowIcon"),b?Sfdc.Dom.addClass(a,"active"):Sfdc.Dom.removeClass(a,"active"))},onKeyUp:function(d,b){if(Sfdc.Event.isKeyAction(d,Sfdc.Event.keyCode.ENTER))SfdcApp.Chatter.SubscribeButton.onClick(d,b)},onClick:function(d,b){var a=Sfdc.Event.getEventTarget(Sfdc.Event.getEvent(d),
"[data-chatter-subscribe]");!a&&b&&(a=Sfdc.select("[data-chatter-subscribe]",b),a="none"===Sfdc.Dom.getStyle(a[0],"display")?a[1]:a[0]);if(a){var c=Sfdc.Dom.getParent(a,"[data-chatter-widget\x3dsubscribeBtn]"),e=c.getAttribute("data-sfdc-entity-id"),g=c.getAttribute("data-sfdc-network-id");if(!Sfdc.Data.get(c,"chatter:subscribing")){Sfdc.Data.set(c,"chatter:subscribing",!0);var f="1"===a.getAttribute("data-chatter-subscribe");f?omnitureWrapper.trackEvent(chatter.getOmnitureEventMap().follow):omnitureWrapper.trackEvent(chatter.getOmnitureEventMap().unfollow);
var a=!1,h=Sfdc.resolve("SfdcApp.Recommend.JitRecsPanel");h&&(a=h.hasJitRecs(e));var k=this;chatter.getToolbox().post({url:"/subscriptions/"+e+(f?";new":";delete"),params:{entityid:e,jitRecs:a,networkId:g},failure:function(){Sfdc.Data.clear(c,"chatter:subscribing")},success:function(a,b){Sfdc.Data.clear(c,"chatter:subscribing");Sfdc.each(Sfdc.select("[data-chatter-widget\x3dsubscribeBtn][data-sfdc-entity-id\x3d"+e+"][data-sfdc-network-id\x3d"+g+"]"),function(a){this._toggle(a,f)},k);chatter.getEventBus().fireEvent("chatter:FollowUnfollow",
f?"onAfterFollow":"onAfterUnfollow",{entityId:e,networkId:g,target:c,followersHtml:b.html,jitRecs:b.jitRecs,jitRecsInit:b.jitRecsInit});return!1}})}}}}})();
Sfdc.provide("SfdcApp.ChatterHoverUtil",function(){var l={},h={DOWNLOAD:{selector:".downloadItemIcon",checkPrevious:!0},UNFOLLOW:{selector:"[data-chatter-subscribe\x3d0]",checkPrevious:!1},FOLLOW:{selector:"[data-chatter-subscribe\x3d1]",checkPrevious:!1},SHARE:{selector:".shareFileWithItemIcon",checkPrevious:!0},MESSAGE:{selector:".openPrivateMessageDialog",checkPrevious:!1},UPLOAD:{selector:".chatterFileUploadNewVersionAction",checkPrevious:!0},CHAT:{selector:".chat",checkPrevious:!1},JOIN:{selector:".asktojoin",
checkPrevious:!1},UNJOIN:{selector:".member",checkPrevious:!1}},m=!0;chatter.getEventBus().addEventListener("chatter:hover","onAfterShowNow",function(a,b){var c=b.entityId;l[c]||(l[c]=!0,Sfdc.logServer("chatterHover",{event:"O",entityId:c}))});return{handlePreviewLoad:function(a){a=Sfdc.select("img",Sfdc.get(a))[0];var b=Sfdc.Dom.getParent(a,".thumbHover"),c=Sfdc.Dom.getNext(b,".thumbHover");if(a.complete)Sfdc.Dom.hideByDisplay(c),Sfdc.Dom.show(b);else Sfdc.on(a,"load",function(){Sfdc.Dom.hideByDisplay(c);
Sfdc.Dom.show(b)})},addChatterCoreCssIfNeeded:function(){if(m){for(var a=document.getElementsByTagName("link"),b=a.length,c=-1,d=!1,f,g=0;g<b&&!d;g++){var e=a[g].href;e&&(d=-1!==e.indexOf("chatterCore.css"),f||(c=e.indexOf("common.css"),-1!==c&&(f=e.substring(0,c))))}!d&&f&&Sfdc.Resource.addCSS(f+"chatterCore.css")}m=!1},onActionClick:function(a,b,c){var d,f=!1,g=Sfdc.Dom,e,k;a=Sfdc.Event.getEventTarget(b);for(d in h)if(h.hasOwnProperty(d)){k=h[d].selector;e=a;for(b=0;4>b;b++){if(g.isMatch(e,k)){f=
!0;break}e=e.parentNode}if(f||h[d].checkPrevious&&g.getPrevious(a,k))return Sfdc.logServer("chatterHover",{event:"A",entityId:c,ac:d})}}}}());
/*

 Copyright (C) 2006 Google Inc.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
var DecorationsT,JobT,SourceSpansT,IN_GLOBAL_SCOPE=!1,PR;window.PR_SHOULD_USE_CONTINUATION=!0;var prettyPrintOne,prettyPrint;
(function(){function T(a){function d(e){var b=e.charCodeAt(0);if(92!==b)return b;var a=e.charAt(1);return(b=V[a])?b:"0"<=a&&"7">=a?parseInt(e.substring(1),8):"u"===a||"x"===a?parseInt(e.substring(2),16):e.charCodeAt(1)}function f(e){if(32>e)return(16>e?"\\x0":"\\x")+e.toString(16);e=String.fromCharCode(e);return"\\"===e||"-"===e||"]"===e||"^"===e?"\\"+e:e}function b(e){var b=e.substring(1,e.length-1).match(/\\u[0-9A-Fa-f]{4}|\\x[0-9A-Fa-f]{2}|\\[0-3][0-7]{0,2}|\\[0-7]{1,2}|\\[\s\S]|-|[^-\\]/g);e=
[];var a="^"===b[0],c=["["];a&&c.push("^");for(var a=a?1:0,g=b.length;a<g;++a){var h=b[a];if(/\\[bdsw]/i.test(h))c.push(h);else{var h=d(h),k;a+2<g&&"-"===b[a+1]?(k=d(b[a+2]),a+=2):k=h;e.push([h,k]);65>k||122<h||(65>k||90<h||e.push([Math.max(65,h)|32,Math.min(k,90)|32]),97>k||122<h||e.push([Math.max(97,h)&-33,Math.min(k,122)&-33]))}}e.sort(function(e,a){return e[0]-a[0]||a[1]-e[1]});b=[];g=[];for(a=0;a<e.length;++a)h=e[a],h[0]<=g[1]+1?g[1]=Math.max(g[1],h[1]):b.push(g=h);for(a=0;a<b.length;++a)h=b[a],
c.push(f(h[0])),h[1]>h[0]&&(h[1]+1>h[0]&&c.push("-"),c.push(f(h[1])));c.push("]");return c.join("")}function r(e){for(var a=e.source.match(RegExp("(?:\\[(?:[^\\x5C\\x5D]|\\\\[\\s\\S])*\\]|\\\\u[A-Fa-f0-9]{4}|\\\\x[A-Fa-f0-9]{2}|\\\\[0-9]+|\\\\[^ux0-9]|\\(\\?[:!\x3d]|[\\(\\)\\^]|[^\\x5B\\x5C\\(\\)\\^]+)","g")),c=a.length,d=[],g=0,h=0;g<c;++g){var k=a[g];"("===k?++h:"\\"===k.charAt(0)&&(k=+k.substring(1))&&(k<=h?d[k]=-1:a[g]=f(k))}for(g=1;g<d.length;++g)-1===d[g]&&(d[g]=++A);for(h=g=0;g<c;++g)k=a[g],
"("===k?(++h,d[h]||(a[g]="(?:")):"\\"===k.charAt(0)&&(k=+k.substring(1))&&k<=h&&(a[g]="\\"+d[k]);for(g=0;g<c;++g)"^"===a[g]&&"^"!==a[g+1]&&(a[g]="");if(e.ignoreCase&&m)for(g=0;g<c;++g)k=a[g],e=k.charAt(0),2<=k.length&&"["===e?a[g]=b(k):"\\"!==e&&(a[g]=k.replace(/[a-zA-Z]/g,function(a){a=a.charCodeAt(0);return"["+String.fromCharCode(a&-33,a|32)+"]"}));return a.join("")}for(var A=0,m=!1,l=!1,n=0,c=a.length;n<c;++n){var p=a[n];if(p.ignoreCase)l=!0;else if(/[a-z]/i.test(p.source.replace(/\\u[0-9a-f]{4}|\\x[0-9a-f]{2}|\\[^ux]/gi,
""))){m=!0;l=!1;break}}for(var V={b:8,t:9,n:10,v:11,f:12,r:13},t=[],n=0,c=a.length;n<c;++n){p=a[n];if(p.global||p.multiline)throw Error(""+p);t.push("(?:"+r(p)+")")}return RegExp(t.join("|"),l?"gi":"g")}function W(a,d){function f(a){var c=a.nodeType;if(1==c){if(!b.test(a.className)){for(c=a.firstChild;c;c=c.nextSibling)f(c);c=a.nodeName.toLowerCase();if("br"===c||"li"===c)r[l]="\n",m[l<<1]=A++,m[l++<<1|1]=a}}else if(3==c||4==c)c=a.nodeValue,c.length&&(c=d?c.replace(/\r\n?/g,"\n"):c.replace(/[ \t\r\n]+/g,
" "),r[l]=c,m[l<<1]=A,A+=c.length,m[l++<<1|1]=a)}var b=/(?:^|\s)nocode(?:\s|$)/,r=[],A=0,m=[],l=0;f(a);return{sourceCode:r.join("").replace(/\n$/,""),spans:m}}function H(a,d,f,b,r){f&&(a={sourceNode:a,pre:1,langExtension:null,numberLines:null,sourceCode:f,spans:null,basePos:d,decorations:null},b(a),r.push.apply(r,a.decorations))}function X(a){for(var d=void 0,f=a.firstChild;f;f=f.nextSibling)var b=f.nodeType,d=1===b?d?a:f:3===b?Y.test(f.nodeValue)?a:d:d;return d===a?void 0:d}function E(a,d){var f=
{},b;(function(){for(var m=a.concat(d),l=[],n={},c=0,p=m.length;c<p;++c){var r=m[c],t=r[3];if(t)for(var e=t.length;0<=--e;)f[t.charAt(e)]=r;r=r[1];t=""+r;n.hasOwnProperty(t)||(l.push(r),n[t]=null)}l.push(/[\0-\uffff]/);b=T(l)})();var r=d.length,A=function(a){for(var l=a.basePos,n=a.sourceNode,c=[l,"pln"],p=0,q=a.sourceCode.match(b)||[],t={},e=0,U=q.length;e<U;++e){var x=q[e],s=t[x],g=void 0,h;if("string"===typeof s)h=!1;else{var k=f[x.charAt(0)];if(k)g=x.match(k[1]),s=k[0];else{for(h=0;h<r;++h)if(k=
d[h],g=x.match(k[1])){s=k[0];break}g||(s="pln")}if((h=5<=s.length&&"lang-"===s.substring(0,5))&&!(g&&"string"===typeof g[1]))h=!1,s="src";h||(t[x]=s)}k=p;p+=x.length;if(h){h=g[1];var y=x.indexOf(h),C=y+h.length;g[2]&&(C=x.length-g[2].length,y=C-h.length);s=s.substring(5);H(n,l+k,x.substring(0,y),A,c);H(n,l+k+y,h,I(s,h),c);H(n,l+k+C,x.substring(C),A,c)}else c.push(l+k,s)}a.decorations=c};return A}function v(a){var d=[],f=[];a.tripleQuotedStrings?d.push(["str",/^(?:\'\'\'(?:[^\'\\]|\\[\s\S]|\'{1,2}(?=[^\']))*(?:\'\'\'|$)|\"\"\"(?:[^\"\\]|\\[\s\S]|\"{1,2}(?=[^\"]))*(?:\"\"\"|$)|\'(?:[^\\\']|\\[\s\S])*(?:\'|$)|\"(?:[^\\\"]|\\[\s\S])*(?:\"|$))/,
null,"'\""]):a.multiLineStrings?d.push(["str",/^(?:\'(?:[^\\\']|\\[\s\S])*(?:\'|$)|\"(?:[^\\\"]|\\[\s\S])*(?:\"|$)|\`(?:[^\\\`]|\\[\s\S])*(?:\`|$))/,null,"'\"`"]):d.push(["str",/^(?:\'(?:[^\\\'\r\n]|\\.)*(?:\'|$)|\"(?:[^\\\"\r\n]|\\.)*(?:\"|$))/,null,"\"'"]);a.verbatimStrings&&f.push(["str",/^@\"(?:[^\"]|\"\")*(?:\"|$)/,null]);var b=a.hashComments;b&&(a.cStyleComments?(1<b?d.push(["com",/^#(?:##(?:[^#]|#(?!##))*(?:###|$)|.*)/,null,"#"]):d.push(["com",/^#(?:(?:define|e(?:l|nd)if|else|error|ifn?def|include|line|pragma|undef|warning)\b|[^\r\n]*)/,
null,"#"]),f.push(["str",/^<(?:(?:(?:\.\.\/)*|\/?)(?:[\w-]+(?:\/[\w-]+)+)?[\w-]+\.h(?:h|pp|\+\+)?|[a-z]\w*)>/,null])):d.push(["com",/^#[^\r\n]*/,null,"#"]));a.cStyleComments&&(f.push(["com",/^\/\/[^\r\n]*/,null]),f.push(["com",/^\/\*[\s\S]*?(?:\*\/|$)/,null]));if(b=a.regexLiterals){var r=(b=1<b?"":"\n\r")?".":"[\\S\\s]";f.push(["lang-regex",RegExp("^(?:^^\\.?|[+-]|[!\x3d]\x3d?\x3d?|\\#|%\x3d?|\x26\x26?\x3d?|\\(|\\*\x3d?|[+\\-]\x3d|-\x3e|\\/\x3d?|::?|\x3c\x3c?\x3d?|\x3e\x3e?\x3e?\x3d?|,|;|\\?|@|\\[|~|{|\\^\\^?\x3d?|\\|\\|?\x3d?|break|case|continue|delete|do|else|finally|instanceof|return|throw|try|typeof)\\s*("+
("/(?\x3d[^/*"+b+"])(?:[^/\\x5B\\x5C"+b+"]|\\x5C"+r+"|\\x5B(?:[^\\x5C\\x5D"+b+"]|\\x5C"+r+")*(?:\\x5D|$))+/")+")")])}(b=a.types)&&f.push(["typ",b]);b=(""+a.keywords).replace(/^ | $/g,"");b.length&&f.push(["kwd",RegExp("^(?:"+b.replace(/[\s,]+/g,"|")+")\\b"),null]);d.push(["pln",/^\s+/,null," \r\n\t\u00a0"]);b="^.[^\\s\\w.$@'\"`/\\\\]*";a.regexLiterals&&(b+="(?!s*/)");f.push(["lit",/^@[a-z_$][a-z_$@0-9]*/i,null],["typ",/^(?:[@_]?[A-Z]+[a-z][A-Za-z_$@0-9]*|\w+_t\b)/,null],["pln",/^[a-z_$][a-z_$@0-9]*/i,
null],["lit",/^(?:0x[a-f0-9]+|(?:\d(?:_\d+)*\d*(?:\.\d*)?|\.\d\+)(?:e[+\-]?\d+)?)[a-z]*/i,null,"0123456789"],["pln",/^\\[\s\S]?/,null],["pun",RegExp(b),null]);return E(d,f)}function J(a,d,f){function b(a){var c=a.nodeType;if(1==c&&!A.test(a.className))if("br"===a.nodeName)r(a),a.parentNode&&a.parentNode.removeChild(a);else for(a=a.firstChild;a;a=a.nextSibling)b(a);else if((3==c||4==c)&&f){var d=a.nodeValue,s=d.match(m);s&&(c=d.substring(0,s.index),a.nodeValue=c,(d=d.substring(s.index+s[0].length))&&
a.parentNode.insertBefore(l.createTextNode(d),a.nextSibling),r(a),c||a.parentNode.removeChild(a))}}function r(a){function b(a,c){var d=c?a.cloneNode(!1):a,k=a.parentNode;if(k){var k=b(k,1),e=a.nextSibling;k.appendChild(d);for(var f=e;f;f=e)e=f.nextSibling,k.appendChild(f)}return d}for(;!a.nextSibling;)if(a=a.parentNode,!a)return;a=b(a.nextSibling,0);for(var d;(d=a.parentNode)&&1===d.nodeType;)a=d;c.push(a)}for(var A=/(?:^|\s)nocode(?:\s|$)/,m=/\r\n?|\n/,l=a.ownerDocument,n=l.createElement("li");a.firstChild;)n.appendChild(a.firstChild);
for(var c=[n],p=0;p<c.length;++p)b(c[p]);d===(d|0)&&c[0].setAttribute("value",d);var q=l.createElement("ol");q.className="linenums";d=Math.max(0,d-1|0)||0;for(var p=0,t=c.length;p<t;++p)n=c[p],n.className="L"+(p+d)%10,n.firstChild||n.appendChild(l.createTextNode("\u00a0")),q.appendChild(n);a.appendChild(q)}function q(a,d){for(var f=d.length;0<=--f;){var b=d[f];G.hasOwnProperty(b)?D.console&&console.warn("cannot override language handler %s",b):G[b]=a}}function I(a,d){if(!a||!G.hasOwnProperty(a))a=
/^\s*</.test(d)?"default-markup":"default-code";return G[a]}function K(a){var d=a.langExtension;try{var f=W(a.sourceNode,a.pre),b=f.sourceCode;a.sourceCode=b;a.spans=f.spans;a.basePos=0;I(d,b)(a);var r=/\bMSIE\s(\d+)/.exec(navigator.userAgent),r=r&&8>=+r[1],d=/\n/g,q=a.sourceCode,m=q.length,f=0,l=a.spans,n=l.length,b=0,c=a.decorations,p=c.length,v=0;c[p]=m;var t,e;for(e=t=0;e<p;)c[e]!==c[e+2]?(c[t++]=c[e++],c[t++]=c[e++]):e+=2;p=t;for(e=t=0;e<p;){for(var z=c[e],x=c[e+1],s=e+2;s+2<=p&&c[s+1]===x;)s+=
2;c[t++]=z;c[t++]=x;e=s}c.length=t;var g=a.sourceNode;a="";g&&(a=g.style.display,g.style.display="none");try{for(;b<n;){var h=l[b+2]||m,k=c[v+2]||m,s=Math.min(h,k),y=l[b+1],C;if(1!==y.nodeType&&(C=q.substring(f,s))){r&&(C=C.replace(d,"\r"));y.nodeValue=C;var L=y.ownerDocument,u=L.createElement("span");u.className=c[v+1];var B=y.parentNode;B.replaceChild(u,y);u.appendChild(y);f<h&&(l[b+1]=y=L.createTextNode(q.substring(s,h)),B.insertBefore(y,u.nextSibling))}f=s;f>=h&&(b+=2);f>=k&&(v+=2)}}finally{g&&
(g.style.display=a)}}catch(w){D.console&&console.log(w&&w.stack||w)}}function M(a,d,f){f=f||!1;d=d||null;var b=document.createElement("div");b.innerHTML="\x3cpre\x3e"+a+"\x3c/pre\x3e";b=b.firstChild;f&&J(b,f,!0);K({langExtension:d,numberLines:f,sourceNode:b,pre:1,sourceCode:null,basePos:null,spans:null,decorations:null});return b.innerHTML}function N(a,d){function f(){for(var b=D.PR_SHOULD_USE_CONTINUATION?c.now()+250:Infinity;p<q.length&&c.now()<b;p++){for(var d=q[p],l=g,n=d;n=n.previousSibling;){var m=
n.nodeType,u=(7===m||8===m)&&n.nodeValue;if(u?!/^\??prettify\b/.test(u):3!==m||/\S/.test(n.nodeValue))break;if(u){l={};u.replace(/\b(\w+)=([\w:.%+-]+)/g,function(a,b,c){l[b]=c});break}}n=d.className;if((l!==g||t.test(n))&&!e.test(n)){m=!1;for(u=d.parentNode;u;u=u.parentNode)if(s.test(u.tagName)&&u.className&&t.test(u.className)){m=!0;break}if(!m){d.className+=" prettyprinted";m=l.lang;if(!m){var m=n.match(v),z;if(!m&&(z=X(d))&&x.test(z.tagName))m=z.className.match(v);m&&(m=m[1])}if(B.test(d.tagName))u=
1;else var u=d.currentStyle,w=r.defaultView,u=(u=u?u.whiteSpace:w&&w.getComputedStyle?w.getComputedStyle(d,null).getPropertyValue("white-space"):0)&&"pre"===u.substring(0,3);w=l.linenums;if(!(w="true"===w||+w))w=(w=n.match(/\blinenums\b(?::(\d+))?/))?w[1]&&w[1].length?+w[1]:!0:!1;w&&J(d,w,u);K({langExtension:m,sourceNode:d,numberLines:w,pre:u,sourceCode:null,basePos:null,spans:null,decorations:null})}}}p<q.length?D.setTimeout(f,250):"function"===typeof a&&a()}for(var b=d||document.body,r=b.ownerDocument||
document,b=[b.getElementsByTagName("pre"),b.getElementsByTagName("code"),b.getElementsByTagName("xmp")],q=[],m=0;m<b.length;++m)for(var l=0,n=b[m].length;l<n;++l)q.push(b[m][l]);var b=null,c=Date;c.now||(c={now:function(){return+new Date}});var p=0,v=/\blang(?:uage)?-([\w.]+)(?!\S)/,t=/\bprettyprint\b/,e=/\bprettyprinted\b/,B=/pre|xmp/i,x=/^code$/i,s=/^(?:pre|code|xmp)$/i,g={};f()}var D=window,z=["break,continue,do,else,for,if,return,while"],B=[[z,"auto,case,char,const,default,double,enum,extern,float,goto,inline,int,long,register,short,signed,sizeof,static,struct,switch,typedef,union,unsigned,void,volatile"],
"catch,class,delete,false,import,new,operator,private,protected,public,this,throw,true,try,typeof"],F=[B,"alignof,align_union,asm,axiom,bool,concept,concept_map,const_cast,constexpr,decltype,delegate,dynamic_cast,explicit,export,friend,generic,late_check,mutable,namespace,nullptr,property,reinterpret_cast,static_assert,static_cast,template,typeid,typename,using,virtual,where"],O=[B,"abstract,assert,boolean,byte,extends,finally,final,implements,import,instanceof,interface,null,native,package,strictfp,super,synchronized,throws,transient"],
P=[B,"abstract,as,base,bool,by,byte,checked,decimal,delegate,descending,dynamic,event,finally,fixed,foreach,from,group,implicit,in,interface,internal,into,is,let,lock,null,object,out,override,orderby,params,partial,readonly,ref,sbyte,sealed,stackalloc,string,select,uint,ulong,unchecked,unsafe,ushort,var,virtual,where"],B=[B,"debugger,eval,export,function,get,instanceof,null,set,undefined,var,with,Infinity,NaN"],Q=[z,"and,as,assert,class,def,del,elif,except,exec,finally,from,global,import,in,is,lambda,nonlocal,not,or,pass,print,raise,try,with,yield,False,True,None"],
R=[z,"alias,and,begin,case,class,def,defined,elsif,end,ensure,false,in,module,next,nil,not,or,redo,rescue,retry,self,super,then,true,undef,unless,until,when,yield,BEGIN,END"],z=[z,"case,done,elif,esac,eval,fi,function,in,local,set,then,until"],S=/^(DIR|FILE|vector|(de|priority_)?queue|list|stack|(const_)?iterator|(multi)?(set|map)|bitset|u?(int|float)\d*)\b/,Y=/\S/,Z=v({keywords:[F,P,O,B,"caller,delete,die,do,dump,elsif,eval,exit,foreach,for,goto,if,import,last,local,my,next,no,our,print,package,redo,require,sub,undef,unless,until,use,wantarray,while,BEGIN,END",
Q,R,z],hashComments:!0,cStyleComments:!0,multiLineStrings:!0,regexLiterals:!0}),G={};q(Z,["default-code"]);q(E([],[["pln",/^[^<?]+/],["dec",/^<!\w[^>]*(?:>|$)/],["com",/^<\!--[\s\S]*?(?:-\->|$)/],["lang-",/^<\?([\s\S]+?)(?:\?>|$)/],["lang-",/^<%([\s\S]+?)(?:%>|$)/],["pun",/^(?:<[%?]|[%?]>)/],["lang-",/^<xmp\b[^>]*>([\s\S]+?)<\/xmp\b[^>]*>/i],["lang-js",/^<script\b[^>]*>([\s\S]*?)(<\/script\b[^>]*>)/i],["lang-css",/^<style\b[^>]*>([\s\S]*?)(<\/style\b[^>]*>)/i],["lang-in.tag",/^(<\/?[a-z][^<>]*>)/i]]),
"default-markup htm html mxml xhtml xml xsl".split(" "));q(E([["pln",/^[\s]+/,null," \t\r\n"],["atv",/^(?:\"[^\"]*\"?|\'[^\']*\'?)/,null,"\"'"]],[["tag",/^^<\/?[a-z](?:[\w.:-]*\w)?|\/?>$/i],["atn",/^(?!style[\s=]|on)[a-z](?:[\w:-]*\w)?/i],["lang-uq.val",/^=\s*([^>\'\"\s]*(?:[^>\'\"\s\/]|\/(?=\s)))/],["pun",/^[=<>\/]+/],["lang-js",/^on\w+\s*=\s*\"([^\"]+)\"/i],["lang-js",/^on\w+\s*=\s*\'([^\']+)\'/i],["lang-js",/^on\w+\s*=\s*([^\"\'>\s]+)/i],["lang-css",/^style\s*=\s*\"([^\"]+)\"/i],["lang-css",/^style\s*=\s*\'([^\']+)\'/i],
["lang-css",/^style\s*=\s*([^\"\'>\s]+)/i]]),["in.tag"]);q(E([],[["atv",/^[\s\S]+/]]),["uq.val"]);q(v({keywords:F,hashComments:!0,cStyleComments:!0,types:S}),"c cc cpp cxx cyc m".split(" "));q(v({keywords:"null,true,false"}),["json"]);q(v({keywords:P,hashComments:!0,cStyleComments:!0,verbatimStrings:!0,types:S}),["cs"]);q(v({keywords:O,cStyleComments:!0}),["java"]);q(v({keywords:z,hashComments:!0,multiLineStrings:!0}),["bash","bsh","csh","sh"]);q(v({keywords:Q,hashComments:!0,multiLineStrings:!0,
tripleQuotedStrings:!0}),["cv","py","python"]);q(v({keywords:"caller,delete,die,do,dump,elsif,eval,exit,foreach,for,goto,if,import,last,local,my,next,no,our,print,package,redo,require,sub,undef,unless,until,use,wantarray,while,BEGIN,END",hashComments:!0,multiLineStrings:!0,regexLiterals:2}),["perl","pl","pm"]);q(v({keywords:R,hashComments:!0,multiLineStrings:!0,regexLiterals:!0}),["rb","ruby"]);q(v({keywords:B,cStyleComments:!0,regexLiterals:!0}),["javascript","js"]);q(v({keywords:"all,and,by,catch,class,else,extends,false,finally,for,if,in,is,isnt,loop,new,no,not,null,of,off,on,or,return,super,then,throw,true,try,unless,until,when,while,yes",
hashComments:3,cStyleComments:!0,multilineStrings:!0,tripleQuotedStrings:!0,regexLiterals:!0}),["coffee"]);q(E([],[["str",/^[\s\S]+/]]),["regex"]);var $=D.PR={createSimpleLexer:E,registerLangHandler:q,sourceDecorator:v,PR_ATTRIB_NAME:"atn",PR_ATTRIB_VALUE:"atv",PR_COMMENT:"com",PR_DECLARATION:"dec",PR_KEYWORD:"kwd",PR_LITERAL:"lit",PR_NOCODE:"nocode",PR_PLAIN:"pln",PR_PUNCTUATION:"pun",PR_SOURCE:"src",PR_STRING:"str",PR_TAG:"tag",PR_TYPE:"typ",prettyPrintOne:IN_GLOBAL_SCOPE?D.prettyPrintOne=M:prettyPrintOne=
M,prettyPrint:prettyPrint=IN_GLOBAL_SCOPE?D.prettyPrint=N:prettyPrint=N},F=D.define;"function"===typeof F&&F.amd&&F("google-code-prettify",[],function(){return $})})();
function ContentFolderListViewPort(n,p,e){function h(){var a="";return a=b&&1<b.length?b[b.length-2].folderName:g}function k(){var a=Sfdc.get(".contentFolderListView .zen-footer"),d=c.totalItems;a&&(d<=l?Sfdc.Dom.hideByDisplay(a):Sfdc.Dom.show(a));(a=Sfdc.get("#folderPickerHover .contentFolderListView \x3e .zen-content"))&&Sfdc.Dom.set(a,"scrollTop","0");(a=Sfdc.get("folderPickerError"))&&Sfdc.Dom.hideByDisplay(a);(a=Sfdc.get(".folderPickerHeader .text"))&&a.focus()}function m(a,d){var b=Sfdc.get("folderName"),
c=Sfdc.get("folderParentNav"),e=Sfdc.get("folderRootName"),f=LC.getLabel("FolderPicker","BackTo",d);b&&(c&&a&&e)&&(a!==g?(Sfdc.Dom.show(c),Sfdc.Dom.hideByDisplay(e),Sfdc.Dom.setText(b,a),b=Sfdc.get("folderParentNav"),c=Sfdc.get("folderName"),b&&c&&(Sfdc.Dom.set(b,"title",f),Sfdc.userAgent.isIE&&Sfdc.Dom.set(c,"title",f))):(Sfdc.Dom.show(e),Sfdc.Dom.hideByDisplay(c)))}function q(){var a=Sfdc.get("#folderPickerHover .zen-loader"),b=Sfdc.get("#folderPickerHover .contentFolderListView \x3e .zen-content");
b&&(b=Sfdc.Dom.get(b,"scrollTop"),a&&Sfdc.Dom.setStyle(a,"top",b+"px"))}Perf.mark("Sfdc.ContentFolderListViewPort:Start");var c,f,b=[],l=e&&e.rowsPerPage||25,g=LC.getLabel("ChatterFilesTabPage","chatterbox");this.navigateToFolder=function(a,d){var e="";c&&(c.additionalParams={folderId:a,docId:Sfdc.ChatterFiles.documentId,style:Sfdc.ChatterFiles.documentStyle},c.currentPage=1,b&&(b.push({folderId:a,folderName:d}),e=h()),c.provide(),m(d,e))};this.navigateToParent=function(){var a,d="";if(c&&b&&(b.pop(),
a=b[b.length-1]))c.additionalParams={folderId:a.folderName!==g?a.folderId:Sfdc.ChatterFiles.rootFolderId,docId:Sfdc.ChatterFiles.documentId,style:Sfdc.ChatterFiles.documentStyle},c.currentPage=1,c.provide(),d=h(),m(a.folderName,d)};this.getParentFolderId=function(){var a;b&&(a=b[b.length-1].folderId);return a};Sfdc.onload(function(){var a=Sfdc.String.format('\x3csfdc:listView class\x3d"contentFolderListView zen-listViewSmall zen-listViewFixed zen-listViewHeaderless"\x3e\x3cdata:provider type\x3d"ListServlet" pageSize\x3d"{pageSize}" resourceUri\x3d"{resourceUri}" viewId\x3d"{viewId}" viewType\x3d"{viewType}" autoProvide\x3d"false"\x3e\x3c/data:provider\x3e\x3cfacet:header\x3e\x3c/facet:header\x3e\x3cfacet:navigation\x3e\x3c/facet:navigation\x3e\x3cfacet:footer\x3e\x3cui:pagerNextPrevious\x3e\x3c/ui:pagerNextPrevious\x3e\x3c/facet:footer\x3e\x3c/sfdc:listView\x3e',
{pageSize:l,resourceUri:UserContext.getUrl("/_ui/content/controller/folders/ContentFolderListServlet"),viewId:"",viewType:p}),d={folderId:Sfdc.ChatterFiles.rootFolderId,folderName:g};b=[];b.push(d);d=Sfdc.get(n+"_listBody");Sfdc.Dom.updateHTML(d,a);SfdcCmp.init(d);f=SfdcCmp.findInstance(d,SfdcCmp.Sfdc.ListView);f.labels.listView.emptyMessage=LC.getLabel("FolderPicker","EmptyFolderList");c=f.getProvider();c.setPayload(e);c.attach("onbeforechange",q);c.attach("onchange",k);c.additionalParams={folderId:Sfdc.ChatterFiles.rootFolderId,
docId:Sfdc.ChatterFiles.documentId,style:Sfdc.ChatterFiles.documentStyle};k()});Sfdc.ns("Sfdc.ChatterFiles.ContentFolderListViewPort");Sfdc.ChatterFiles.ContentFolderListViewPort.INSTANCE=this;Perf.endMark("Sfdc.ContentFolderListViewPort:Start")};
(function(){function f(){}function e(a){SfdcApp.Chatter.Hover.call(this,a);this.hover&&Sfdc.Dom.addClass(this.hover,["folderPickerHover","zen"])}function l(a){for(var b,d,c=0,g=a.offsetParent;g;)b=parseInt(a.style.marginLeft,10),isNaN(b)&&(b=0),d=parseInt(a.style.marginRight,10),isNaN(d)&&(d=0),c+=g.offsetWidth-(a.offsetLeft+a.offsetWidth+b+d),a=g,g=a.offsetParent;return c}f.prototype=SfdcApp.Chatter.Hover.prototype;e.prototype=new f;Sfdc.apply(e.prototype,{addHoverListener:function(a){if(a)Sfdc.on(document,
"click",this.onMouseMove,this);else Sfdc.un(document,"click",this.onMouseMove)},setPosRightLeft:function(){var a,b=this.hoverItem.getPositionXY(),d=this.invertDirForRtl(this.defaultDir),c=this.hover.style;Sfdc.Dom.addClass(this.hoverChild,d);c.position="absolute";c.zIndex=105;a=parseInt(c.top,10);isNaN(a)&&(a=this.hover.offsetTop);a=b.y-Sfdc.Dom.getElementXY(this.hover).y+a-4;"DetailPage"===this.pickerSrc&&(a-=4);c.top=a+"px";a=b.x+this.hoverItem.el.offsetWidth;Sfdc.userAgent.isIE||(a-=this.hover.offsetParent?
Sfdc.Dom.getPositionXY(this.hover.offsetParent)[0]:0);"chatterHover-left"===d?c.right=l(this.hoverItem.el)+this.hoverItem.el.offsetWidth-(this.hover.offsetParent?l(this.hover.offsetParent):0)+"px":c.left=a+"px";this.loaded&&(this.isLow(b)?this.hoverContent.style.top=-(-40+Sfdc.Dom.getHeight(this.hoverContent))+20+"px":this.hoverContent.style.top="-36px")}});Sfdc.provide("SfdcApp.Chatter.FolderPickerHover",{createHover:function(a,b,d){var c=this;a.id=Sfdc.getUID(a);this.pickerHover=new e({id:"folderPickerHover",
hoverItem:new SfdcApp.Chatter.BaseHoverItem({el:a,dir:SfdcApp.Chatter.Hover.direction.RIGHT,id:a.id}),loader:{load:function(b,e,f){var h=chatter.getToolbox(),k=Ext.get(a);h.mask(k);chatter.getToolbox().get({url:"/listview/folders",params:Sfdc.ChatterFiles.getUpdatedParams(d),success:function(a,b){e.call(f,b.html);var d=Sfdc.get("folderParentNavDiv");d&&Sfdc.Dom.show(d);c.toggleErrorClass(!1);Sfdc.ChatterFiles.rootFolderId=b.folderId;h.unmask(k)},failure:function(a,b){e.call(f,null);c.toggleErrorClass(!0);
h.unmask(k)}})}}});b&&this.pickerHover&&(this.pickerHover.pickerSrc=b.style);return this.pickerHover},toggleErrorClass:function(a){this.pickerHover&&(a?Sfdc.Dom.addClass(this.pickerHover.hoverContent,"error"):Sfdc.Dom.removeClass(this.pickerHover.hoverContent,"error"))}})})();
Sfdc.ns("SfdcApp.ChatterGroupMembership");
SfdcApp.ChatterGroupMembership=function(){function k(a){return Sfdc.Dom.getParent(a,".groupmembership")}function l(a,c){var b;if(Sfdc.isArray(a))for(b=a.length;b--;)l(a[b],c);else a.innerHTML=Sfdc.String.getIntValue(a.innerHTML,10)+(c?1:-1)}function p(a,c,b){b=Sfdc.select("[data-gid\x3d"+b+"] .membercount");if(b.length)l(b,c);else if(b=Sfdc.get(".membercount",Sfdc.Dom.getParent(a,"tr"))){l(b,c);return}a=Sfdc.Dom.getParent(a,".groupManagementContainer");null!==a&&Sfdc.each(Sfdc.select(".groupmembercount",
a),function(a){l(a,c)})}function m(a,c,b){a=Sfdc.Dom.getParent(a,".groupManagementContainer");if(null!==a){b.message&&Dialogs.showSimpleInfo("",b.message,null);for(var d=0;d<b.htmllist.length;d++)for(var e=b.htmllist[d],f=e.html,e=e.idlist,g=0;g<e.length;g++)Sfdc.get(".request_"+e[g]+" .memberTableRole",a).innerHTML=f;Sfdc.each(Sfdc.select(".groupmemberrequestcount",a),function(a){a.innerHTML=Sfdc.String.getIntValue(a.innerHTML)-c.length});Sfdc.each(Sfdc.select(".groupmembercount",a),function(a){a.innerHTML=
Sfdc.String.getIntValue(a.innerHTML)+b.acceptedcount});Sfdc.each(Sfdc.select("input.acceptAll"),function(a){if(1==c.length){var b=Sfdc.String.getIntValue(a.getAttribute("count_page_request"))-1;if(3>b)q();else{var d=Sfdc.JSON.parse(a.getAttribute("requests"));d.remove(c[0]);a.setAttribute("requests",'["'+d.join('","')+'"]');d=Sfdc.String.getIntValue(a.getAttribute("count_total_request"))-1;a.setAttribute("count_total_request",d);a.setAttribute("count_page_request",b);a.setAttribute("value",LC.getLabel("ChatterGroups",
"membership_admin_acceptall",b,d));a.setAttribute("title",LC.getLabel("ChatterGroups","membership_admin_acceptall_title",b,d))}}else q()})}}function q(){Sfdc.each(Sfdc.select("input.acceptAll"),function(a){Ext.get(a).slideOut("t",{easing:"easeOut",duration:0.5,remove:!0,callback:function(){Ext.select("tr.acceptAll").remove()}})})}var h=!1,r=!1,n="",s={onHover:function(a,c){var b=k(a),b=Sfdc.get(".actionIcon",b);c?Sfdc.Dom.addClass(b,"active"):Sfdc.Dom.removeClass(b,"active")},asktojoin:function(a,
c){var b=chatter.getToolbox(),d=Ext.get(a);b.mask(d);var e=k(a),f={};f.style=c.style;b.post({url:"/groups/"+c.groupId+"/memberrequests;create",params:f,success:function(a,d){h=!0;d.message&&Dialogs.showSimpleInfo("",d.message,null);c.refresh?b.refresh():Sfdc.Dom.getParent(e).innerHTML=d.html},failure:function(a,c){b.unmask(d)}})},withdrawRequest:function(a,c){Dialogs.showSimpleConfirmation("",LC.getLabel("ChatterGroups","membership_request_withdraw_confirm"),function(){var b=Ext.get(a),d=chatter.getToolbox();
d.mask(b);var e=k(a),f={};f.style=c.style;d.post({url:"/groups/"+c.groupId+"/memberrequests;delete",params:f,success:function(a,b){h=!0;b.message&&Dialogs.showSimpleInfo("",b.message,null);c.refresh?d.refresh():Sfdc.Dom.getParent(e).innerHTML=b.html},failure:function(a,c){d.unmask(b)}})})},acceptAll:function(a,c){var b=chatter.getToolbox();b.disableButton(a);var d={};d.userId=c.userId;d.requestIds=c.requestIds;d.status=c.status;d.style=c.style;d.accept=!0;b.post({url:"/groups/"+c.groupId+"/memberrequests;edit",
params:d,success:function(d,f){h=!0;c.refresh?b.refresh():m(a,c.requestIds,f)},failure:function(a,c){403==a.status&&b.refresh()}})},actOnAcceptRequest:function(a,c){var b=chatter.getToolbox(),d=k(a),e=Sfdc.get(".accept",d),f=Ext.get(Sfdc.get(".decline",d));b.disableButton(e);b.mask(f);var g={};g.userId=c.userId;g.requestIds=c.requestIds;g.status="accepted";g.style=c.style;g.filter=SfdcApp.ChatterGroupAddRemoveMemberOverlay.getCurrentFilter();b.post({url:"/groups/"+c.groupId+"/memberrequests;edit",
params:g,success:function(a,f){h=!0;if(c.refresh)b.refresh();else{var e=Sfdc.Dom.getParent(d);m(e,c.requestIds,f)}},failure:function(a,c){403==a.status&&b.refresh();b.enableButton(e);b.unmask(f)}})},onFocusDeclineMessage:function(a){Sfdc.Dom.removeClass(a,"unfocus");Sfdc.String.trim(a.value)==LC.getLabel("ChatterGroups","membership_request_optional_msg")&&(a.value="")},toggleDeclineDetails:function(a){var c=chatter.getToolbox(),b=Sfdc.Dom.getParent(a,".overlayDialog");a=Sfdc.Dom.getParent(a,"tr");
var d=Sfdc.Dom.hasClass(a,"declineExpanded");Sfdc.Dom.toggleClass(a,"declineExpanded");d?(Sfdc.Dom.show(Sfdc.select(".memberTableName, .memberTableRole",a)),Sfdc.Dom.hideByDisplay(Sfdc.select(".declineDetails",a))):(Sfdc.Dom.show(Sfdc.select(".declineDetails",a)),Sfdc.Dom.hideByDisplay(Sfdc.select(".memberTableName, .memberTableRole",a)));Sfdc.each(Sfdc.select(".btn",b),function(a){!Sfdc.Dom.hasClass(a,"declineSend")&&!Sfdc.Dom.hasClass(a,"declineCancel")&&(d?c.enableButton(a):c.disableButton(a))});
var e=Sfdc.get(".quickfindInput",b);d?c.enable(e):c.disable(e);Sfdc.each(Sfdc.select("a",b),function(a){a=Ext.get(a);d?c.unmask(a):c.mask(a)});Sfdc.each(Sfdc.select("img",b),function(a){d?(a.setAttribute("onclick",a.getAttribute("onclickold")),a.removeAttribute("onclickold")):(a.setAttribute("onclickold",a.getAttribute("onclick")),a.setAttribute("onclick","return false;"))});d||a.scrollIntoView(!0)},actOnDeclineRequest:function(a,c){var b=chatter.getToolbox(),d={};d.userId=c.userId;d.requestIds=c.requestIds;
d.status="declined";d.style=c.style;d.filter=SfdcApp.ChatterGroupAddRemoveMemberOverlay.getCurrentFilter();var e=Sfdc.get(".responseMessage",Sfdc.Dom.getParent(a,".declineDetails")).value;Sfdc.String.trim(e)!=LC.getLabel("ChatterGroups","membership_request_optional_msg")&&(d.responseMessage=e);b.post({url:"/groups/"+c.groupId+"/memberrequests;edit",params:d,success:function(d,e){h=!0;if(c.refresh)b.refresh();else{s.toggleDeclineDetails(a);var t=Sfdc.Dom.getParent(Sfdc.get(".groupmembership",Sfdc.Dom.getParent(a,
"tr")));m(t,c.requestIds,e)}},failure:function(a,c){403==a.status&&b.refresh()}})},join:function(a,c){var b=chatter.getToolbox(),d=Ext.get(a);d.is("input")?b.disableButton(d.dom):b.mask(d);var e=k(a),f={};c.onBehalfOf&&(f.userId=c.onBehalfOf);f.style=c.style;omnitureWrapper.trackEvent(chatter.getOmnitureEventMap().joinGroup);Perf.mark("createGroupMember");b.post({url:"/groups/"+c.groupId+"/members;create",params:f,success:function(a,d){h=!0;d.message&&Dialogs.showSimpleInfo("",d.message,null);if(c.refresh)b.refresh();
else{var f=Sfdc.Dom.getParent(e);f.innerHTML=d.html;chatter.getEventBus().fireEvent("chatter:joinGroup","onAfterJoin",{entityId:c.groupId,target:f});p(f,!0,c.groupId)}},failure:function(a,c){d.is("input")?(b.enableButton(d),403==a.status&&b.refresh()):b.unmask(d)}})},leave:function(a,c){var b=function(){var b=Ext.get(a),e=chatter.getToolbox();e.mask(b);var f=k(a),g={};chatter.getToolbox().stringIsEmpty(n)||(g.currentUserProfileId=n);c.onBehalfOf&&(g.userId=c.onBehalfOf);g.style=c.style;omnitureWrapper.trackEvent(chatter.getOmnitureEventMap().unjoinGroup);
Perf.mark("removeGroupMember");e.post({url:"/groups/"+c.groupId+"/members;delete",params:g,success:function(a,b){h=!0;b.message&&Dialogs.showSimpleInfo("",b.message,null);if(b.url)chatter.getToolbox().navigateTo(b.url);else if(c.refresh)e.refresh();else{var d=Sfdc.Dom.getParent(f);d.innerHTML=b.html;chatter.getEventBus().fireEvent("chatter:leaveGroup","onAfterLeave");p(d,!1,c.groupId)}},failure:function(a,c){e.unmask(b)}})};c.onBehalfOf?Dialogs.showSimpleConfirmation("",LC.getLabel("ChatterGroups",
"membership_remove_confirm"),b):Dialogs.showSimpleConfirmation("",LC.getLabel("ChatterGroups","membership_leave_confirm"),b)},isDirty:function(){return h},disableRefreshOnClose:function(){r=!0},isDisableRefresOnClose:function(){return r},setCurrentUserProfileId:function(a){n=a}};return s}();
Sfdc.provide("SfdcApp.Recommend",function(){function k(){this.data=[];this.requestInProgress=!1}function l(a){a=a||{};this.id=a.id||null;this.clientSideCache=new k;this.recType=null;this.idsAlreadyHave=[];this.isPage=!1;this.hiddenDiv=null;this.isInit=!1;this.bindEvents();chatter.getEventBus().addEventListener("chatter:feed","onAfterFeedRefresh",this.bindEvents,this);chatter.getEventBus().addEventListener("chatter:navigation","onAfterHtmlUpdate",this.bindEvents,this);chatter.getEventBus().addEventListener("chatter:feed",
"onBeforeRemoveFeed",this.unbindEvents,this)}var f,d={REC_TYPES:"data-rectype",REC_ID:"data-recid",PROC_NAME:"data-recprocname",EXPLAIN_TYPE:"data-explaintype",FEATURE_VALUES:"data-featurevalues"};k.prototype={store:function(a){Array.prototype.push.apply(this.data,a)},get:function(a,b){var c=this.data.shift(),e=this;!c&&!this.requestInProgress?(this.requestInProgress=!0,chatter.getToolbox().post({url:a.url,params:a.params,success:function(c,d){e.requestInProgress=!1;d.extraRecs&&e.store(d.extraRecs);
a.success.call(b,e.data.shift(),d.extraRecs)},failure:function(){e.requestInProgress=!1;a.failure&&a.failure.apply(b,arguments)}})):a.success.call(b,c,[])},remove:function(a){a=Sfdc.Array.indexOf(this.data,a);return-1!==a?this.data.splice(a,1):!1}};l.prototype={smoothReplace:function(a,b,c,e){c&&(c=Sfdc.Function.bind(c,e));a.parentNode&&(Sfdc.Dom.hideByVisibility(b),a.parentNode.insertBefore(b,a),Sfdc.Dom.removeChild(a),Sfdc.Effects.fadeIn(b,c))},fadeOutFadeIn:function(a,b,c,e){var d=this;Sfdc.Effects.fadeOut(a,
function(){d.smoothReplace(a,b,c,e)})},rejectRec:function(a){Sfdc.get("ReadOnlyBanner")?alert(LC.getLabel("Exception","InvalidReadOnlyUserDmlException_desc")):this.replaceRec(a,a.getAttribute(d.REC_ID))},explainRec:function(a,b){var c=Sfdc.Dom.getNext(a,".recExpl");c&&(Sfdc.Data.get(a,"clicked")?Sfdc.Dom.isVisible(c)?Sfdc.Dom.hideByDisplay(c):Sfdc.Dom.show(c):(Sfdc.Data.set(a,"clicked",!0),chatter.getToolbox().post({url:"/recommended/explain/"+b,params:{explaintype:a.getAttribute(d.EXPLAIN_TYPE)},
success:function(a,b){c.innerHTML+=b.html;Sfdc.Dom.show(c)}})))},onAccepted:function(a,b){Sfdc.get(this.id)&&this.replaceRec(b.target,b.entityId,!0)},getNoMoreRecsElement:function(){var a=Sfdc.get(this.id).ownerDocument.createElement("span");a.className="noMoreRecs";a.innerHTML=LC.getLabel("RecommendedGeneral","no_recs")||"";this.getNoMoreRecsElement=function(){return a};return a},doRemoveRecElement:function(a){Sfdc.Dom.removeChild(a)},removeRecElement:function(a){this.doRemoveRecElement(a);this.isEmpty()&&
(this.unbindEvents(),this.fadeOutFadeIn(Sfdc.get("#"+this.id+" .recBox"),this.getNoMoreRecsElement()))},isEmpty:function(){return!Sfdc.select("#"+this.id+" .recElement").length},extractRecElement:function(a,b,c){var e=null,e=Sfdc.Dom.isMatch(a,".recElement")?a:Sfdc.Dom.getParent(a,".recElement");!e&&(c&&-1<this.idsAlreadyHave.indexOf(b))&&(a=Sfdc.select("#"+this.id+" *["+d.REC_ID+"\x3d"+b+"]"),a.length&&(e=a[0]));return e},reportAction:function(a,b,c,e,d,g,m){chatter.getToolbox().post({url:"/recommended/"+
(e?"accept":"reject")+"/"+c,params:{uri:window.location.pathname,origrecprocname:a,nextrecprocname:b,nextrec:m?m.id:null,origfeaturevalues:d,nextfeaturevalues:g}})},hideRecElement:function(a,b,c,d){var f=this;Sfdc.Effects.fadeOut(a,function(){d.call(f,a,b,c)})},showNewRecElement:function(a,b){this.smoothReplace(b,a,function(){this.isPage||chatter.getEventBus().fireEvent("chatter:hover","onAfterUpdate",{container:a})},this)},replaceRec:function(a,b,c){var e,f,g;this.isInit||this.init();if(!this.clientSideCache.remove(b)&&
(g=this.extractRecElement(a,b,c)))e=g.getAttribute(d.PROC_NAME),f=g.getAttribute(d.FEATURE_VALUES),a=function(a,e,f){this.clientSideCache.get({url:"/recommend/"+this.recType,params:{idsAlreadyHave:this.idsAlreadyHave,isPage:this.isPage},success:function(g,k){var h;Sfdc.each(k,function(a){this.idsAlreadyHave.push(a.id)},this);g?(h=a.ownerDocument.createElement("div"),h.innerHTML=g.html,h=3==h.childElementCount?h.children[1]:h.firstChild,this.reportAction(e,h.getAttribute(d.PROC_NAME),b,c,f,h.getAttribute(d.FEATURE_VALUES),
g),this.showNewRecElement(h,a)):(this.reportAction(e,null,b,c,f,null,null),this.removeRecElement(a))},failure:function(){this.removeRecElement(a)}},this)},Sfdc.Dom.addClass(g,"recBlueBg"),this.hideRecElement(g,e,f,a)},init:function(){var a;this.isInit=!0;if(a=Sfdc.get(this.id))this.recType=a.getAttribute(d.REC_TYPES),Sfdc.each(Sfdc.select("#"+this.id+" .recElement"),function(a){a&&(a=a.getAttribute(d.REC_ID))&&this.idsAlreadyHave.push(a)},this)},onClick:function(a){var b=Sfdc.Event.getEventTarget(a,
".recDismissLink");b?this.rejectRec(this.getRecElement(b)):(b=Sfdc.Event.getEventTarget(a,"*["+d.EXPLAIN_TYPE+"]"))&&this.explainRec(b,this.getRecElement(b).getAttribute(d.REC_ID),b.getAttribute(d.EXPLAIN_TYPE))},onHover:function(a){var b;if(b=Sfdc.Event.getEventTarget(a,".recElement"))(b=Sfdc.select(".recDismissImage",b)[0])&&("mouseover"===a.type?Sfdc.Dom.addClass(b,"recDismissVisible"):Sfdc.Dom.removeClass(b,"recDismissVisible"))},getRecElement:function(a){return Sfdc.Dom.getParent(a,".recElement")},
bindEvents:function(){var a,b;if(!this.isEventsBinded&&(b=Sfdc.get(this.id)))a=chatter.getEventBus(),a.addEventListener("chatter:FollowUnfollow","onAfterFollow",this.onAccepted,this),a.addEventListener("chatter:joinGroup","onAfterJoin",this.onAccepted,this),Sfdc.on(b,"click",this.onClick,this),Sfdc.on(b,"mouseover",this.onHover,this),Sfdc.on(b,"mouseout",this.onHover,this),this.isEventsBinded=!0},unbindEvents:function(){var a;if(this.isEventsBinded&&(a=Sfdc.get(this.id)))Sfdc.un(a,"click",this.onClick),
Sfdc.un(a,"mouseover",this.onHover),Sfdc.un(a,"mouseout",this.onHover),a=chatter.getEventBus(),a.removeEventListener("chatter:FollowUnfollow","onAfterFollow",this.onAccepted,this),a.removeEventListener("chatter:joinGroup","onAfterJoin",this.onAccepted,this),this.isEventsBinded=!1}};return{create:function(a){Sfdc.get(a.id)&&(f=new SfdcApp.Recommend[a.ctor]({id:a.id}),this.isLoaded=!0)},destroy:function(){f&&(f.unbindEvents(),f=null)},isLoaded:!1,RecommendationGrid:l,DATA_ATTRIBUTES:d}}());
(function(f){function h(a,b,c){f.each(f.select("["+p+"\x3d"+b+"]",a),c)}function k(a,b,c){var d,e=a+l+f.getUID(b);d=g[e];d||(c=c||{},c.element=b,a=m[a],d=new a(c),"function"===typeof d.initialize&&d.initialize(),g[e]=d);return d}function n(a,b){var c=a+l+f.getUID(b),d=g[c];d&&(d.destroy(),delete g[c])}var p="data-topicwidget",l="$$",e=f.ns("SfdcApp.TopicUtils"),g={},m={};e.registerWidgetType=function(a,b){m[a]=b};e.unwireInstance=n;e.wireInstance=k;e.wireDescendents=function(a,b,c){h(a,b,function(a){k(b,
a,c)})};e.unwireDescendents=function(a,b){h(a,b,function(a){n(b,a)})}})(Sfdc);
TopicsAutoCompleteElement=function(a,b,c,d,e,f,h,k,g){AccessibleAutoCompleteInputElement.apply(this,[a,"/chatter/handlers/topics/complete/"+f,b,c,d]);this.displayHeader=!1;this.suggestions=null;this.box=e;this.feedItemId=f;this.textUtil=chatter.getTextUtil();this.assignOnly=h;this.hideTalkingAbout=k;this.hideSuccessMessage=!0===g};TopicsAutoCompleteElement.prototype=new AccessibleAutoCompleteInputElement;
TopicsAutoCompleteElement.prototype.setSuggestions=function(a){(this.suggestions=a)&&0<this.suggestions.length?(this.focused=!0,this.displaySuggestions(!0)):(!this.curSuggestions||0===this.curSuggestions.length)&&this.clearACBox()};TopicsAutoCompleteElement.prototype.displayDefault=function(){this.suggestions&&0<this.suggestions.length?(this.focused=!0,this.displaySuggestions(!0)):this.clearACBox()};
TopicsAutoCompleteElement.prototype.isNav=function(a){return!a||!a.keyCode?!1:a.keyCode==KEY_ARROW_D||a.keyCode==KEY_ARROW_U||a.keyCode==KEY_ARROW_L||a.keyCode==KEY_ARROW_R||a.keyCode==KEY_ESC||a.keyCode==KEY_TAB||a.keyCode==KEY_DELETE||a.keyCode==KEY_BACKSPACE||a.keyCode==KEY_SHIFT||a.keyCode==KEY_ENTER};
TopicsAutoCompleteElement.prototype.isSuggesting=function(a){if(this.curSuggestions)for(var b=0;b<this.curSuggestions.length;b++)if(this.normalizeTopic(this.curSuggestions[b].name)===this.normalizeTopic(a))return!0;return!1};
TopicsAutoCompleteElement.prototype.handleNav=function(a){var b=Sfdc.String.trim(this.element.value);if(KEY_ENTER==a.keyCode&&!this.hasValidSelection())if(this.assignOnly&&!this.isSuggesting(b))Sfdc.Event.preventDefault(a);else{if(this.hasValidText()&&!this.isAdded(b)){if(b.length>SfdcApp.TopicsFeed.TOPIC_MAX_SIZE||b.match(SfdcApp.TopicsFeed.INVALID_CHARS)){Sfdc.Event.preventDefault(a);alert(LC.getLabel("TopicsFeed","badTopicName"));return}if(this.getTopicsCount()>=SfdcApp.TopicsFeed.MAX_TOPICS){Sfdc.Event.preventDefault(a);
alert(LC.getLabel("TopicsFeed","tooManyTopicsNoHints"));return}}SfdcApp.TopicsFeed.done(Sfdc.Dom.getParent(this.box,".topics"),!1,this.hideSuccessMessage)}else if(KEY_ESC!=a.keyCode)if(KEY_COMMA==a.keyCode){var c=this;setTimeout(function(){c.handleComma()},0)}else KEY_TAB==a.keyCode?this.navigateTopics(a):(KEY_ARROW_L==a.keyCode||KEY_ARROW_R==a.keyCode)&&this.getSelected()||0===this.textUtil.getCaretLocation(this.element)&&KEY_ARROW_L==a.keyCode?this.navigateTopics(a):this.getSelected()&&(KEY_DELETE==
a.keyCode||KEY_BACKSPACE==a.keyCode)?(b=this.getSelected(),SfdcApp.TopicsFeed.deleteTopic(b,this.feedItemId),this.navigateTopics(a)):((KEY_ARROW_U==a.keyCode||KEY_ARROW_D==a.keyCode)&&this.clearSelected(),AutoCompleteInputElement.prototype.handleNav.call(this,a))};TopicsAutoCompleteElement.prototype.handleComma=function(){if(this.element.value.match(",$")&&(this.element.value=this.element.value.replace(/,+$/,""),(!this.assignOnly||this.isSuggesting(name))&&this.complete()))this.element.value=""};
TopicsAutoCompleteElement.prototype.navigateTopics=function(a){var b=Sfdc.Dom.getPrevious(this.element,".topicList"),c=Sfdc.get(".topic.selected",b),d,e=null===c?null:c,f=a.keyCode==KEY_ARROW_R||a.keyCode==KEY_DELETE||KEY_BACKSPACE==a.keyCode||a.keyCode==KEY_TAB&&!a.shiftKey;if(e)d=f?Sfdc.Dom.getNext(e,".topic"):Sfdc.Dom.getPrevious(e,".topic");else if(this.hasValidSelection()){this.select(-1);if(f)return;Sfdc.Event.preventDefault(a)}else if(null===e)if(a.keyCode==KEY_TAB&&this.curSuggestions&&this.curSuggestions.length&&
0<this.curSuggestions.length)this.select(0);else if(f){if(a.keyCode==KEY_TAB&&(!this.curSuggestions||!this.curSuggestions.length||0===this.curSuggestions.length))return}else b=Sfdc.select(".topic",b),d=b[b.length-1];((a.keyCode==KEY_ARROW_R||a.keyCode==KEY_TAB)&&null===d||d&&c&&d!=this.selectedTopic)&&this.clearSelected();a.keyCode==KEY_TAB&&a.shiftKey&&null===d||(d&&d!=c&&(Sfdc.Dom.addClass(d,"selected"),this.select(-1)),Sfdc.Event.preventDefault(a))};
TopicsAutoCompleteElement.prototype.getSelected=function(){return Sfdc.get(".topic.selected",this.box)};TopicsAutoCompleteElement.prototype.clearSelected=function(){var a=this.getSelected();a&&Sfdc.Dom.removeClass(a,"selected")};
TopicsAutoCompleteElement.prototype.handleInput=function(a){if(-1<this.element.value.indexOf(",")){a=this.element.value.split(",");for(var b=a.length,c=0;c<b-1;c++)Sfdc.String.trim(a[c])&&this.validateAndAddTopic(a[c]);this.element.value=a[b-1];Sfdc.Dom.set(this.element,"length",2)}else this.isNav(a)||this.clearSelected(),this.isNav(a)&&!this.inKeyIME&&(this.element.value=this.element.value.replace("\n","")),AutoCompleteInputElement.prototype.handleInput.call(this,a)};
TopicsAutoCompleteElement.prototype.innerGetSuggestions=function(a){var b,c=[];this.element&&a.length>=this.minSuggestLen&&!Sfdc.Dom.hasClass(this.element,"ghost")&&(b=this.checkCacheOrRetrieve(a))&&(b=this.getValidSuggestions(a,b));b&&0<b.length&&c.push({title:null,suggestions:b});this.suggestions&&0<this.suggestions.length&&c.push({title:null,suggestions:this.suggestions});return 0===c.length?null:c};
TopicsAutoCompleteElement.prototype.getValidSuggestions=function(a,b){var c=AutoCompleteInputElement.prototype.getValidSuggestions.call(this,a,b);return 5<c.length?c.splice(0,5):c};TopicsAutoCompleteElement.prototype.isValidSuggestion=function(a,b){var c;c=this.getRegexForInput(a);if(!b.name.match(c)||this.isAdded(b.name))return!1;if(this.suggestions)for(c=0;c<this.suggestions.length;c++)if(this.sameTopic(b.name,this.suggestions[c].name))return!1;return!0};
TopicsAutoCompleteElement.prototype.positionACBox=function(a){if(this.element&&this.acBox&&(!a||this.isACBoxVisible()))a=this.getACWidth(),this.acBox.setStyle("width",a+"px")};TopicsAutoCompleteElement.prototype.addMarkupBeforeGroup=function(a,b){0<b&&a.push('\x3cdiv class\x3d"line"\x3e\x26nbsp;\x3c/div\x3e')};TopicsAutoCompleteElement.prototype.getACWidth=function(){return this.box.clientWidth};TopicsAutoCompleteElement.prototype.getMinimumWidth=function(){return this.box.clientWidth};
TopicsAutoCompleteElement.prototype.handleEmptyInput=function(){this.curSuggestions=this.getSuggestions("");this.updateACBox(this.curSuggestions)};
TopicsAutoCompleteElement.prototype.complete=function(){if(!this.element)return!1;if(this.hasValidSelection()){var a=this.curSuggestions[this.selected],b=this.getRegexForInput(this.element.value);this.addTopic(a.name,a.id,a.suggestionType,a.suggestionScore,a.suggestionRank,a.position,a.postLength);AutoCompleteInputElement.normalize(a.name).match(b)&&(this.element.value="",Sfdc.Dom.set(this.element,"length",2));SfdcApp.TopicsFeed.clearGhost(this.element)}else{if(this.hasValidText()&&(a=Sfdc.String.trim(this.element.value),
!this.validateAndAddTopic(a)))return!1;this.element.value="";Sfdc.Dom.set(this.element,"length",2)}this.displayDefault(!0);this.select(-1);this.element.focus();return!0};TopicsAutoCompleteElement.prototype.validateAndAddTopic=function(a){var b=!0;SfdcApp.TopicsFeed.isValidTopicName(a)?this.isAdded(a)?alert(LC.getLabel("TopicsFeed","alreadyAssigned")+": "+a):this.addTopic(a):(alert(LC.getLabel("TopicsFeed","badTopicName")+": "+a),b=!1);return b};
TopicsAutoCompleteElement.prototype.hasValidText=function(){return Sfdc.Dom.hasClass(this.element,"ghost")?!1:0<Sfdc.String.trim(this.element.value).length};TopicsAutoCompleteElement.prototype.getSelectedSuggestion=function(){return this.hasValidSelection()?this.curSuggestions[this.selected]:null};TopicsAutoCompleteElement.prototype.sameTopic=function(a,b){return this.normalizeTopic(a)===this.normalizeTopic(b)};
TopicsAutoCompleteElement.prototype.normalizeTopic=function(a){return a.replace(/\s/g,"").toLowerCase()};TopicsAutoCompleteElement.prototype.isAdded=function(a){var b,c=Sfdc.select(".topic",this.box);for(b=0;b<c.length;b++)if(this.sameTopic(a,c[b].getAttribute("data-topicname")))return!0;return!1};TopicsAutoCompleteElement.prototype.getTopicsCount=function(){var a=Sfdc.select(".topic",this.box);return a&&a.length?a.length:0};
TopicsAutoCompleteElement.prototype.addTopic=function(a,b,c,d,e,f,h){var k=Sfdc.get(".topicList",this.box),g=document.createElement("li");k.appendChild(g);Sfdc.Dom.addClass(g,"topic");g.innerHTML='\x3cdiv class\x3d"name"\x3e'+Sfdc.String.escapeToHtml(a,!1)+'\x3ca href\x3d"javascript: void(0);" tabindex\x3d"-1" \x3e\x3cimg class\x3d"delete" src\x3d"/s.gif"\x3e\x3c/a\x3e';g.setAttribute("data-topicname",a);this.removeFromSuggestions(this.suggestions,a);this.removeFromSuggestions(this.curSuggestions,
a);SfdcApp.TopicsFeed.setupTopicElem(g);SfdcApp.TopicsFeed.save(this.feedItemId,a,b,g,c,d,e,f,h)};TopicsAutoCompleteElement.prototype.removeFromSuggestions=function(a,b){if(a)for(i=0;i<a.length;i++)if(this.sameTopic(b,a[i].name)){a.splice(i,1);break}};TopicsAutoCompleteElement.prototype.hook_registerEventHandlers=function(){var a=this;Sfdc.on(this.element,"focus",function(){a.focused=!0});Sfdc.on(this.element,"keyup",function(b){a.handleInput(b)});Sfdc.on(this.element,"keydown",function(b){a.handleNav(b)})};
TopicsAutoCompleteElement.prototype.addACBoxToPage=function(a){var b=document.createElement("div");Sfdc.Dom.addClass(b,"topicsAc");b.appendChild(a);this.box.parentNode.appendChild(b);if(Sfdc.userAgent.isIE7&&(a=Sfdc.Dom.getParent(this.box,".feeditembodyandfooter")))a.style.zIndex=100};
TopicsAutoCompleteElement.prototype.retrieveFromServlet=function(a){if(!a||a.length<this.minSuggestLen)return!1;255<a.length&&(a=a.substring(0,255));if(this.triedQueries[this.getCacheKey(a)])return!1;this.triedQueries[this.getCacheKey(a)]=!0;var b=this;chatter.getToolbox().post({url:"/topics/complete/"+this.feedItemId,params:{topicPrefix:a},success:function(c,d){d.suggestions&&(b.saveToCache(a,d.suggestions),b.displaySuggestions(!0),0===d.suggestions.length&&b.hook_onEmptyServletResult(a))}});return!0};
TopicsAutoCompleteElement.prototype.getCacheKey=function(a){return a};TopicsAutoCompleteElement.prototype.disableAC=function(){if(this.enabled){this.enabled=!1;this.clearSuggestions();if(Sfdc.userAgent.isIE7){var a=Sfdc.Dom.getParent(this.box,".feeditembodyandfooter");a&&(a.style.zIndex=0)}AutoCompleteInputElement.prototype.clearACBox.call(this)}};TopicsAutoCompleteElement.prototype.clearACBox=function(){this.scrolling=!1;this.groupedSuggestions=null;this.deselect();this.displayACBox()};
TopicsAutoCompleteElement.prototype.addFooter=function(a,b){0===b&&(null===this.suggestions?a.push('\x3ctr\x3e\x3ctd\x3e\x3cdiv class\x3d"loadingsuggestions"/\x3e \x3cimg src\x3d"/s.gif"/\x3e \x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e'):a.push('\x3ctr\x3e\x3ctd\x3e\x3cdiv class\x3d"nosuggestions"/\x3e '+LC.getLabel("TopicsFeed","noMoreSuggestions")+"\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e"))};
TopicsAutoCompleteElement.prototype.getSuggestionHtml=function(a){var b=[];b.push("\x3cspan class\x3d'actitle'\x3e");var c=escapeHTML(this.findInput(this.lastInput)),d=escapeHTML(a.name);c&&0<Sfdc.String.trim(c).length&&(c=this.getRegexForInput(c),d=d.replace(c,'$1\x3cstrong class\x3d"autocompleteMatch"\x3e$2\x3c/strong\x3e'));b.push(d);b.push("\x3c/span\x3e");!this.hideTalkingAbout&&a.talkingAbout&&(b.push("\x3cspan class\x3d'aclabel'\x3e"),b.push(a.talkingAbout),b.push("\x3c/span\x3e"));return b.join("")};
FileSharedWithAutoComplete=function(a){FileSharedWithAutoComplete.superclass.constructor.call(this,a,"/autocomplete",{},null,!0,null,null,null);this.isOverlay=!0};Ext.extend(FileSharedWithAutoComplete,PublisherAutoComplete);
FileSharedWithAutoComplete.prototype.getACHelpHTML=function(){if(this.isACMention){var a=LC.getLabel("PublisherAutoComplete","typeMentionFeedShare");return['\x3cdiv class\x3d"',PublisherAutoComplete.HELP_TEXT_CSS_CLASS,'"\x3e',a,"\x3c/div\x3e"]}return['\x3cdiv class\x3d"',PublisherAutoComplete.HELP_TEXT_CSS_CLASS,'"\x3e',LC.getLabel("PublisherAutoComplete","typeSomethingHashTag"),"\x3c/div\x3e"]};
PublisherCKEditorAutoComplete=function(a,b,c,e,f,d,g,h,k,l,m){this.ckEditor=b;PublisherCKEditorAutoComplete.superclass.constructor.call(this,b.container.$.id,c,e,f,d,g,h,k,l,m);this.textareaId=a};Ext.extend(PublisherCKEditorAutoComplete,PublisherAutoComplete);PublisherCKEditorAutoComplete.prototype.toggleEnabled=function(a){var b=chatter.getPublisher().getTextArea();a?chatter.getToolbox().enable(b):chatter.getToolbox().disable(b)};
PublisherCKEditorAutoComplete.prototype.setCKEditor=function(a){this.ckEditor=a;a=a.container.$;this.id=a.id;this.element=a;this.hook_registerEventHandlers()};
PublisherCKEditorAutoComplete.prototype.hook_registerEventHandlers=function(){var a=this,b=this.ckEditor.editable().$;addEvent(b,"blur",function(){a.focused=!1;if(!a.acBoxFocused){var c=a.getOnBlurDelay();0<c?setTimeout(function(){a.clearSuggestions()},c):a.clearSuggestions()}});addEvent(b,"focus",function(){a.focused=!0});addEvent(b,"keyup",function(c){a.handleInput(c)});addEvent(b,"keydown",function(c){a.handleNav(c)});this.ckEditor.on("key",function(c){a.isACBoxVisible()&&13==c.data.keyCode&&c.cancel()});
this.ckEditor.on("beforeCommandExec",function(c){a.isACBoxVisible()&&(Sfdc.log("Cancelling the cke event as atmention suggestions are visible and don't support formatting",Sfdc.Logging.LogLevel.INFO),c.cancel())})};
PublisherCKEditorAutoComplete.prototype.getInputWithEncodedAtMentions=function(){var a="",b=new CKEDITOR.filter(this.ckEditor.config.allowedContent);b.addTransformations([[{element:"span",left:function(a){return!Sfdc.isEmpty(a.attributes["data-mention"])},right:function(a,c){var b=CKEDITOR.tools.htmlDecodeAttr(a.attributes["data-mention"]),b=CKEDITOR.tools.htmlEncode(b);a.setHtml(b)}}]]);var c=new CKEDITOR.htmlParser.basicWriter;try{var e=CKEDITOR.htmlParser.fragment.fromHtml(this.getValue());b.applyTo(e);
e.writeHtml(c);a=c.getHtml()}catch(f){Sfdc.log(f)}return a};PublisherCKEditorAutoComplete.prototype.focus=function(){chatter.getToolbox().focusAtEndOfTextOnCKEditor(this.ckEditor)};PublisherCKEditorAutoComplete.prototype.getValue=function(){return chatter.getToolbox().getDataFromCKEditor(this.ckEditor)};PublisherCKEditorAutoComplete.prototype.setValue=function(a){var b=this;this.ckEditor.on("dataReady",function(a){b.setCKEditor(a.editor)});this.ckEditor.setData(a||"")};
PublisherCKEditorAutoComplete.prototype.setFocusedValue=function(a,b,c){var e=CKEDITOR.dom.element.createFromHtml("\x3cspan\x3e\x3c/span\x3e");a=this.ckEditor.document.createText(a);b=CKEDITOR.dom.element.createFromHtml(b);var f=Sfdc.isEmpty(c);c=this.ckEditor.document.createText(f?String.fromCharCode(160):c);var d=this.getRange();d.startContainer.setText("");d.insertNode(c);f&&d.insertNode(e);d.insertNode(b);d.insertNode(a);this.ckEditor.widgets.initOn(b,"chatterMention");f?(d.setStartAfter(c),d.setEndAfter(c)):
(d.setStart(c,0),d.setEnd(c,0));d.select();chatter.getPublisher().setRTEData(this.getValue())};PublisherCKEditorAutoComplete.prototype.getFocusedValue=function(){var a=this.getRange();return a?a.startContainer.getText():""};PublisherCKEditorAutoComplete.prototype.createMention=function(a){var b=PublisherAutoComplete.prototype.createMention.call(this,a);return this.createReadonlyTag(this.encodeMention(a),b)};
PublisherCKEditorAutoComplete.prototype.createHashtag=function(a){a=PublisherAutoComplete.prototype.createHashtag.call(this,a);return this.createReadonlyTag(a,a)};PublisherCKEditorAutoComplete.prototype.createReadonlyTag=function(a,b){return'\x3cspan data-mention\x3d"'+CKEDITOR.tools.htmlEncodeAttr(a)+'" contenteditable\x3d"false"\x3e'+CKEDITOR.tools.htmlEncode(b)+"\x3c/span\x3e"};PublisherCKEditorAutoComplete.prototype.isRichText=function(){return!0};
PublisherCKEditorAutoComplete.prototype.getRange=function(){var a=this.ckEditor.getSelection();return(a=a?a.getRanges():null)?a[0]:null};PublisherCKEditorAutoComplete.prototype.getCaretLocation=function(){var a=this.getRange();return a?a.startOffset:0};PublisherCKEditorAutoComplete.prototype.setCaretLocation=function(a){};
PublisherCKEditorAutoComplete.prototype.showNotice=function(a,b,c){if(1==c){var e=this;chatter.getToolbox().onCkEditorInstanceReady(this.ckEditor,function(){chatter.getToolbox().showOrRemoveCKEditorErrorBackground(e.ckEditor,!0)})}PublisherAutoComplete.prototype.showNotice.call(this,a,b,c)};PublisherCKEditorAutoComplete.prototype.hideNotice=function(a){a=PublisherAutoComplete.prototype.hideNotice.call(this,a);!1===a&&chatter.getToolbox().showOrRemoveCKEditorErrorBackground(this.ckEditor,!1);return a};
(function(){Sfdc.provide("SfdcApp.Recommend.JitRecommendationGrid",function(){function a(b){SfdcApp.Recommend.RecommendationGrid.call(this,b)}a.prototype=new SfdcApp.Recommend.RecommendationGrid;a.prototype.replaceRec=function(b,a,d){var c;if(b&&(b=this.extractRecElement(b,a,d)))this.reportAction(b.getAttribute(SfdcApp.Recommend.DATA_ATTRIBUTES.PROC_NAME),null,a,d,null),this.unbindEvents(),c=Sfdc.Dom.getParent(Sfdc.get(this.id),".jitRecs"),Sfdc.Effects.fadeOut(c,function(){Sfdc.Dom.removeChild(c)})};
return a}())})();
(function(){Sfdc.provide("SfdcApp.Recommend.JitRecsPanel",{subjectId:null,wire:function(b){this.subjectId=b;chatter.getEventBus().addEventListener("chatter:FollowUnfollow","onAfterFollow",function(e,c){var a,d;if(c.jitRecs&&c.entityId===b){if(d=Sfdc.get("jitRecsPlaceholder"))a=document.createElement("div"),a.innerHTML=Sfdc.String.trim(c.jitRecs),a=Sfdc.Dom.getFirstChild(a,".jitRecs"),Sfdc.Dom.hideByVisibility(a),d.parentNode.insertBefore(a,d),Sfdc.Dom.removeChild(d),Sfdc.Effects.fadeIn(a);Sfdc.Resource.addInlineJavaScript(c.jitRecsInit)}})},
hasJitRecs:function(b){return this.subjectId===b}})})();
SfdcApp.TopicUtils.registerWidgetType("TopicInfoBubble",function(a){function d(b){b=b.element;if(this.button=a.get("."+c.CSS_INFO_BUBBLE_BUTTON,b))this.bubble=a.get("."+c.CSS_INFO_BUBBLE,b),a.on(this.button,"click",this.buttonOnClick,this)}var c={CSS_HIDDEN:"hidden",CSS_INFO_BUBBLE:"topic-infoBubble",CSS_INFO_BUBBLE_BUTTON:"iconParent"};d.prototype={buttonOnClick:function(b){a.Dom.hasClass(this.bubble,c.CSS_HIDDEN)?(a.Dom.removeClass(this.bubble,c.CSS_HIDDEN),a.on(document,"click",this.documentOnClick,
this),a.on(this.bubble,"keydown",this.onKeyDown,this),a.on(this.bubble,a.userAgent.isIE?"focusout":"blur",this.hide,this,!a.userAgent.isIE),a.Event.stopPropagation(b)):this.hide()},destroy:function(){this.button&&this.bubble&&(a.un(this.button,"click",this.buttonOnClick),this.removeInfoBubbleEvents())},documentOnClick:function(b){a.Event.getEventTarget(b,"."+c.CSS_INFO_BUBBLE)||this.hide()},hide:function(){a.Dom.addClass(this.bubble,c.CSS_HIDDEN);this.removeInfoBubbleEvents()},onKeyDown:function(a){27===
a.keyCode&&this.hide()},removeInfoBubbleEvents:function(){a.un(document,"click",this.documentOnClick);a.un(this.bubble,"keydown",this.onKeyDown);a.un(this.bubble,a.userAgent.isIE?"focusout":"blur",this.hide)}};return d}(Sfdc));
(function(){Sfdc.provide("SfdcApp.TopicsFeed",{TOPIC_MAX_SIZE:99,MAX_TOPICS:100,MAX_FEED_ITEM_TOPICS:10,LINK_USED_CLASS:"clicked",TOPIC_COMPONENT_SELECTOR:".topics",TOPIC_SELECTOR:".topic",FEED_ITEM_SELECTOR:".feeditem",KNOWLEDGE_ARTICLE_SELECTOR:".knowledgeTopic",TOPICS_ON_RECORD_PAGE_SELECTOR:".topicsOnRecordPage",EXTRA_SELECTOR:".extra",MORE_SELECTOR:".more",MORE_LINK_SELECTOR:".moreLink",EDIT_SELECTOR:".editLink",TOPIC_NAME_SELECTOR:"tailBreadcrumbNode",ASSIGNED_IN_EDITOR:"Editor",ASSIGNED_IN_HASHTAG:"HashTag",
INVALID_CHARS:"[\\]]",DONE_MESSAGE_DISPLAY:3E3,trimTopic:function(a){a=Sfdc.String.trim(a);return 255<a.length?a.substring(0,255):a},setupTopicElem:function(a){if(Sfdc.userAgent.isIE7){var b=Sfdc.Dom.getParent(a,".topicInput");b&&a.clientWidth>=0.9*b.clientWidth&&Sfdc.Dom.addClass(a,"wrap")}},inFeed:function(a){return null!==Sfdc.Dom.getParent(a,".feedcontainer")},isValidTopicName:function(a){return a.length<=SfdcApp.TopicsFeed.TOPIC_MAX_SIZE&&!a.match(SfdcApp.TopicsFeed.INVALID_CHARS)},isValidInput:function(a,
b,c){if(b&&0<Sfdc.String.trim(b.value).length&&!Sfdc.Dom.hasClass(b,"ghost")){b=this.trimTopic(b.value);if(a.isAdded(b))return alert(LC.getLabel("TopicsFeed","alreadyAssigned")),!1;if("0D5"==c.substring(0,3)&&a.getTopicsCount()>=SfdcApp.TopicsFeed.MAX_FEED_ITEM_TOPICS||a.getTopicsCount()>=SfdcApp.TopicsFeed.MAX_TOPICS)return alert(LC.getLabel("TopicsFeed","toManyTopics")),!1;if(!this.isValidTopicName(b))return alert(LC.getLabel("TopicsFeed","badTopicName")+": "+b),!1}return!0},isLinkUsed:function(a){if(null===
a)return!1;if(Sfdc.Dom.hasClass(a,this.LINK_USED_CLASS))return!0;Sfdc.Dom.addClass(a,this.LINK_USED_CLASS);return!1},more:function(a){var b=Sfdc.get(SfdcApp.TopicsFeed.MORE_SELECTOR,a);a=Sfdc.get(SfdcApp.TopicsFeed.EXTRA_SELECTOR,a);Sfdc.Dom.removeClass(a,"extra");Sfdc.Dom.removeChild(b)},moreOrLess:function(a){var b=Sfdc.get(SfdcApp.TopicsFeed.EXTRA_SELECTOR,a);a=Sfdc.get(SfdcApp.TopicsFeed.MORE_LINK_SELECTOR,a);Sfdc.Dom.isVisible(b)?(Sfdc.Dom.hideByDisplay(b),Sfdc.Dom.updateHTML(a,LC.getLabel("TopicsFeed",
"showMore"))):(Sfdc.Dom.show(b,!0),Sfdc.Dom.updateHTML(a,LC.getLabel("TopicsFeed","showLess")))},editFromMenu:function(a){a=Sfdc.get(SfdcApp.TopicsFeed.TOPIC_COMPONENT_SELECTOR,Sfdc.get(a));SfdcApp.TopicsFeed.edit(a)},edit:function(a,b,c,d,e,k){var g=this,f=Sfdc.get(SfdcApp.TopicsFeed.EDIT_SELECTOR,a);d={suggestionType:d,suggestionScore:e,suggestionRank:k,assignedIn:SfdcApp.TopicsFeed.ASSIGNED_IN_EDITOR,widgetStyle:a.getAttribute("data-widgetStyle")};this.isLinkUsed(f)||(c?d.topicId=c:b&&(d.topicName=
this.trimTopic(b)),b=a.getAttribute("data-entityId"),chatter.getToolbox().post({url:"/topics/edit/"+b,params:d,success:function(b,c){c.html&&g.showEdit(a,c.html)}}))},done:function(a,b,c){var d=a.getAttribute("data-entityId"),e=SfdcApp.TopicsFeed.getAcInstance(d),k=this,g={assignedIn:SfdcApp.TopicsFeed.ASSIGNED_IN_EDITOR},f=Sfdc.get(".input",a);if(f&&!Sfdc.Dom.hasClass(f,"ghost")){var h=this.trimTopic(f.value);if(h&&(!Sfdc.Dom.hasClass(a,"nocreate")||e.isSuggesting(h))&&!b)if(SfdcApp.TopicsFeed.isValidInput(e,
f,d))g.topicName=h;else{f.focus();return}}c&&(g.noSuccess=!0);g.isWidget=a.getAttribute("data-isWidget");g.referrer=a.getAttribute("data-referrer");g.widgetStyle=a.getAttribute("data-widgetStyle");if(b=a.getAttribute("data-customUrl"))g.customUrl=b;Sfdc.Dom.removeChild(Sfdc.get(".topicsEditor",a));e&&e.disableAC();this.isLinkUsed(Sfdc.get(".topicEditDone",a))||(chatter.getToolbox().post({url:"/topics/refresh/"+d,params:g,success:function(b,c){SfdcApp.TopicUtils.unwireDescendents(a,"TopicInfoBubble");
var d=Sfdc.Dom.getParent(a);Sfdc.Dom.removeChild(a);c.html&&(Sfdc.Dom.insertHTML(d,c.html),d=Sfdc.get(".topics",d),k.setupHandlers(d),k.fadeOutSuccess(d),Sfdc.userAgent.isIE7&&(d.style.width=Sfdc.Dom.getWidth(d)))}}),Sfdc.un(document.body,"click",SfdcApp.TopicsFeed.handleGlobalEvents),Sfdc.un(document.body,"focus",SfdcApp.TopicsFeed.handleGlobalEvents,!0),Sfdc.un(document.body,"focusin",SfdcApp.TopicsFeed.handleGlobalEvents))},fadeOutSuccess:function(a){var b=Sfdc.get(".success",a);if(b){Sfdc.Aria.notify(Sfdc.Dom.getText(b));
var c=Sfdc.get(".view",a);Sfdc.Dom.hideByDisplay(c);setTimeout(function(){Sfdc.Effects.fadeOut(b,function(){Sfdc.Dom.removeChild(b);Sfdc.Effects.fadeIn(c)})},SfdcApp.TopicsFeed.DONE_MESSAGE_DISPLAY)}},setupHandlers:function(a){var b;if(b=Sfdc.isString(a)?Sfdc.get(a):a){a=b.getAttribute("data-entityId");var c=Sfdc.get(SfdcApp.TopicsFeed.MORE_LINK_SELECTOR,b),d=b.getAttribute("data-widgetStyle");if(c){if(d&&"ENHANCED"===d.toUpperCase())Sfdc.on(c,"click",function(){SfdcApp.TopicsFeed.moreOrLess(b)});
else Sfdc.on(c,"click",function(){SfdcApp.TopicsFeed.more(b)});SfdcApp.TopicsFeed.applyHoverHandler(c)}for(var c=Sfdc.select(SfdcApp.TopicsFeed.TOPIC_SELECTOR,b),e=0;e<c.length;e++)SfdcApp.TopicsFeed.applyHoverHandler(c[e]),d&&"ENHANCED"===d.toUpperCase()&&SfdcApp.TopicsFeed.applyTopicHandlers(c[e],a);if(a=Sfdc.get(SfdcApp.TopicsFeed.EDIT_SELECTOR,b))Sfdc.on(a,"click",function(){SfdcApp.TopicsFeed.edit(b)});SfdcApp.TopicUtils.wireDescendents(b,"TopicInfoBubble");Sfdc.Dom.addClass(b,"init")}},addHoverClass:function(a){Sfdc.Dom.addClass(this,
"hover")},removeHoverClass:function(a){Sfdc.Dom.removeClass(this,"hover")},applyTopicHandlers:function(a,b){var c=Sfdc.get(".delete",a).parentNode;Sfdc.on(c,"click",function(){SfdcApp.TopicsFeed.deleteTopic(a,b)});Sfdc.on(a,"mouseover",function(){Sfdc.Dom.addClass(a,"topicHover")});Sfdc.on(a,"mouseout",function(){Sfdc.Dom.removeClass(a,"topicHover")});SfdcApp.TopicsFeed.setupTopicElem(a)},deleteTopic:function(a,b){var c=a.getAttribute("data-topicid"),d=Sfdc.get(".input",Sfdc.Dom.getParent(a,SfdcApp.TopicsFeed.TOPIC_COMPONENT_SELECTOR));
d&&d.focus();chatter.getToolbox().post({url:"/topics/delete/"+b+"/"+c,success:function(b,c){Sfdc.Dom.removeChild(a)}})},closeAllHighlightSessions:function(){var a,b=Sfdc.select(SfdcApp.TopicsFeed.TOPIC_COMPONENT_SELECTOR);for(a=0;a<b.length;a++)Sfdc.get(".view.highlight",b[a])&&SfdcApp.TopicsFeed.done(b[a])},showEdit:function(a,b){var c=a.getAttribute("data-entityId"),d="RECORD_PAGE"===a.getAttribute("data-referrer"),e=a.getAttribute("data-widgetStyle")&&"ENHANCED"===a.getAttribute("data-widgetStyle").toUpperCase(),
k=SfdcApp.TopicsFeed.isHideSuccessMessage(a);b=Sfdc.Dom.insertHTML(a,b);if(e){Sfdc.Dom.hideByDisplay(Sfdc.get(".view",a));var g=Sfdc.get(".moreLink",a);g&&Sfdc.Dom.hideByDisplay(g)}else Sfdc.Dom.removeChild(Sfdc.get(".view",a));(g=Sfdc.get(".success",a))&&Sfdc.Dom.removeChild(g);var f=Sfdc.get(".input",a),g=Sfdc.get(".topicInput",a),h=Sfdc.get(".topicEditDone",a),m=Sfdc.get(".topicsEditor",a),m=Sfdc.Dom.getWidth(m),h=Sfdc.Dom.getWidth(h),h=m-h-36;e?d=new StandaloneTopicsAutoCompleteElement(f.id,2,
null,!1,g,c,Sfdc.Dom.hasClass(a,"nocreate"),d,a):(Sfdc.Dom.setStyle(g,"width",h+"px"),d=new TopicsAutoCompleteElement(f.id,2,null,!1,g,c,Sfdc.Dom.hasClass(a,"nocreate"),d,k));d.displayDefault();if(Sfdc.userAgent.isFirefox&&!e){var l=function(){f.style.width="1000px";Sfdc.un(f,"keydown",l)};Sfdc.on(f,"keydown",l)}else Sfdc.on(f,"keyup",function(){SfdcApp.TopicsFeed.adjustInputWidth(f)}),Sfdc.on(f,"keydown",function(){SfdcApp.TopicsFeed.adjustInputWidth(f)});Sfdc.Dom.hasClass(f,"ghost")&&(Sfdc.on(f,
"keydown",function(){SfdcApp.TopicsFeed.clearGhost(f)}),Sfdc.on(f,"mousedown",function(){var a=Sfdc.Dom.getWidth(f);SfdcApp.TopicsFeed.clearGhost(f);f.style.width=a+"px"}));Sfdc.on(Sfdc.get(".topicEditDone",a),"click",function(){SfdcApp.TopicsFeed.done(a,!1,k)});Sfdc.on(g,"click",function(a){a=Sfdc.Event.getEventTarget(a);!Sfdc.Dom.hasClass(a,"topic")&&!Sfdc.Dom.getParent(a,SfdcApp.TopicsFeed.TOPIC_SELECTOR)&&f.focus()});if(!e){e=Sfdc.select(SfdcApp.TopicsFeed.TOPIC_SELECTOR,a);for(d=0;d<e.length;d++)this.applyTopicHandlers(e[d],
c)}Sfdc.userAgent.isChrome?(e=f.value,f.value="",f.focus(),f.value=e):f.focus();Sfdc.on(document.body,"click",SfdcApp.TopicsFeed.handleGlobalEvents);setTimeout(function(){Sfdc.on(document.body,"focus",SfdcApp.TopicsFeed.handleGlobalEvents,this,!0)},0);Sfdc.on(document.body,"focusin",SfdcApp.TopicsFeed.handleGlobalEvents);var n=this;chatter.getToolbox().post({url:"/topics/suggest/"+c,params:{editMode:!0},success:function(a,b){b.suggestions&&n.getAcInstance(c).setSuggestions(b.suggestions)}})},adjustInputWidth:function(a){var b=
Sfdc.Dom.computeTextWidth(a.value+".",a)+15;Sfdc.Dom.setStyles(a,{width:b+"px"})},clearGhost:function(a){Sfdc.Dom.hasClass(a,"ghost")&&(Sfdc.Dom.removeClass(a,"ghost"),a.value="")},save:function(a,b,c,d,e,k,g,f,h){chatter.getToolbox().post({url:"/topics/assignTo/"+a,params:{topicId:c,isWidget:!SfdcApp.TopicsFeed.inFeed(d),topicName:SfdcApp.TopicsFeed.trimTopic(b),suggestionType:e,suggestionScore:k,suggestionRank:g,topicPosition:f,postLength:h,assignedIn:SfdcApp.TopicsFeed.ASSIGNED_IN_EDITOR},success:function(b,
c){c.topicId?(d.setAttribute("data-topicid",c.topicId),SfdcApp.TopicsFeed.applyTopicHandlers(d,a)):(Sfdc.Dom.removeChild(d),alert(LC.getLabel("TopicsFeed","badTopicName")))},failure:function(a,b){Sfdc.Dom.removeChild(d)}})},getAcInstance:function(a){return AutoCompleteInputElement.instanceRefs["input"+a]},applyHandlersNew:function(){SfdcApp.TopicsFeed.applyHandlers(!1)},applyHandlersAll:function(){SfdcApp.TopicsFeed.applyHandlers(!0)},applyHandlers:function(a){var b,c=Sfdc.select(SfdcApp.TopicsFeed.TOPIC_COMPONENT_SELECTOR);
for(b=0;b<c.length;b++){var d=c[b];(a||!Sfdc.Dom.hasClass(d,"init"))&&SfdcApp.TopicsFeed.setupHandlers(d)}},beforeNewFeedPost:function(){SfdcApp.TopicsFeed.closeAllHighlightSessions()},afterNewFeedPost:function(a,b){var c=b.json.feedItemId;if(c){var d=Sfdc.get(SfdcApp.TopicsFeed.TOPIC_COMPONENT_SELECTOR,Sfdc.get(c));if(d&&(SfdcApp.TopicsFeed.setupHandlers(d),!Sfdc.get(".topicPage"))){var e=Sfdc.get(SfdcApp.TopicsFeed.EDIT_SELECTOR,d);e&&e.focus();chatter.getToolbox().post({url:"/topics/suggest/"+
c,success:function(a,b){var c,e=Sfdc.get(".suggestions",d);if(0===b.suggestions.length)e.innerHTML=LC.getLabel("TopicsFeed","noSuggestions");else{e.innerHTML="";for(c=0;c<b.suggestions.length;c++){var m=b.suggestions[c];0!==c&&e.appendChild(document.createTextNode(", "));var l=document.createElement("a");l.innerHTML=Sfdc.String.escapeToHtml(m.name);l.setAttribute("href","#");e.appendChild(l);Sfdc.Dom.addClass(l,"discreteLink");SfdcApp.TopicsFeed.applyHoverHandler(l);SfdcApp.TopicsFeed.applyAddHandler(d,
l,m)}}}})}}},afterUpdateFeedItem:function(a,b){var c=b.feedItemId;c&&(c=Sfdc.get(SfdcApp.TopicsFeed.TOPIC_COMPONENT_SELECTOR,Sfdc.get(c)))&&SfdcApp.TopicsFeed.setupHandlers(c)},afterComment:function(a,b){var c=Sfdc.Dom.getParent(b.element,SfdcApp.TopicsFeed.FEED_ITEM_SELECTOR);(c=Sfdc.get(SfdcApp.TopicsFeed.TOPIC_COMPONENT_SELECTOR,c))&&SfdcApp.TopicsFeed.done(c,!0,!0)},applyAddHandler:function(a,b,c){Sfdc.on(b,"click",function(){SfdcApp.TopicsFeed.edit(a,c.name,c.id,c.suggestionType,c.suggestionScore,
c.suggestionRank)})},applyHoverHandler:function(a){Sfdc.on(a,"mouseover",SfdcApp.TopicsFeed.addHoverClass,a);Sfdc.on(a,"mouseout",SfdcApp.TopicsFeed.removeHoverClass,a)},handleGlobalEvents:function(a){var b=Sfdc.get(".topicsEditor"),c=Sfdc.Dom.getParent(b),d=c.getAttribute("data-widgetStyle"),e=c.getAttribute("data-referrer"),e=e&&"VISUAL_FORCE_WIDGET"===e.toUpperCase(),d=d&&"ENHANCED"===d.toUpperCase()&&!e;b&&(e=Sfdc.Event.getEventTarget(a),(!(d&&"focus"===a.type)||!Sfdc.Dom.hasClass(e,"rightContent")&&
!Sfdc.Dom.hasClass(e,"leftContent"))&&null===Sfdc.Dom.getParent(e,".topicsEditor")&&(e!=b&&null===Sfdc.Dom.getParent(e,".autoCompleteGroup")&&!Sfdc.Dom.hasClass(e,"autoCompleteSelectedRow")&&!Sfdc.Dom.hasClass(e,"autoCompleteRow")&&!Sfdc.Dom.hasClass(e,"autoCompleteRowLink")&&!Sfdc.Dom.hasClass(e,"autocompleteMatch")&&!Sfdc.Dom.hasClass(e,"actitle")&&!Sfdc.Dom.hasClass(e,"aclabel"))&&SfdcApp.TopicsFeed.done(Sfdc.Dom.getParent(b,SfdcApp.TopicsFeed.TOPIC_COMPONENT_SELECTOR),!0,SfdcApp.TopicsFeed.isHideSuccessMessage(c)))},
isHideSuccessMessage:function(a){a=a.getAttribute("data-topicHideSuccess");return null!==a&&"true"===a}});chatter.getEventBus().addEventListener("chatter:feed","onBeforeNewPostFeedUpdate",SfdcApp.TopicsFeed.beforeNewFeedPost);chatter.getEventBus().addEventListener("chatter:feed","onAfterNewPostFeedUpdate",SfdcApp.TopicsFeed.afterNewFeedPost);chatter.getEventBus().addEventListener("chatter:publisher","onAfterUpdateFeedItem",SfdcApp.TopicsFeed.afterUpdateFeedItem);chatter.getEventBus().addEventListener("chatter:publisher",
"onAfterComment",SfdcApp.TopicsFeed.afterComment);chatter.getEventBus().addEventListener("chatter:feed","onAfterShowMoreFeedItems",SfdcApp.TopicsFeed.applyHandlersNew);chatter.getEventBus().addEventListener("chatter:feed","onAfterFeedRefresh",SfdcApp.TopicsFeed.applyHandlersAll);chatter.getEventBus().addEventListener("unifiedSearchPage:feedSearchResults","onAfterResultsShown",SfdcApp.TopicsFeed.applyHandlersAll)})();
StandaloneTopicsAutoCompleteElement=function(b,c,d,e,f,g,h,a,k){TopicsAutoCompleteElement.apply(this,[b,c,d,e,f,g,h,a]);this.topicContainer=k};StandaloneTopicsAutoCompleteElement.prototype=new TopicsAutoCompleteElement;
StandaloneTopicsAutoCompleteElement.prototype.addTopic=function(b,c,d,e,f,g,h){var a=document.createElement("div");a.innerHTML='\x3ca class\x3d"discreteLink"\x3e'+Sfdc.String.escapeToHtml(b,!1)+'\x3c/a\x3e\x3cspan class\x3d"name"\x3e\x3ca href\x3d"javascript: void(0);" tabindex\x3d"-1" \x3e\x3cimg class\x3d"delete" src\x3d"/s.gif"\x3e\x3c/a\x3e\x3c/span\x3e';a.setAttribute("class","topic standaloneTopicWidget");a.setAttribute("data-topicname",b);Sfdc.get(".placeholder",this.topicContainer).appendChild(a);
var k=Sfdc.get(".topicList",this.box),a=document.createElement("li");k.appendChild(a);Sfdc.Dom.addClass(a,"topic");a.innerHTML='\x3cdiv class\x3d"name"\x3e'+Sfdc.String.escapeToHtml(b,!1)+'\x3ca href\x3d"javascript: void(0);" tabindex\x3d"-1" \x3e\x3cimg class\x3d"delete" src\x3d"/s.gif"\x3e\x3c/a\x3e';a.setAttribute("data-topicname",b);this.removeFromSuggestions(this.suggestions,b);this.removeFromSuggestions(this.curSuggestions,b);SfdcApp.TopicsFeed.setupTopicElem(a);SfdcApp.TopicsFeed.save(this.feedItemId,
b,c,a,d,e,f,g,h)};StandaloneTopicsAutoCompleteElement.prototype.isAdded=function(b){var c,d=Sfdc.select(".topic.standaloneTopicWidget",this.container);for(c=0;c<d.length;c++)if(this.sameTopic(b,d[c].getAttribute("data-topicname")))return!0;return!1};
Sfdc.Event.fireEvent(chatter,"chatter:onDeferLoad");chatter.onDeferLoad=function(a){a()};Sfdc.provide("SfdcApp.ChatterDeferLoaded",{});

//# sourceMappingURL=/javascript/1684699876461/sfdc/source/ChatterDefer.js.map
